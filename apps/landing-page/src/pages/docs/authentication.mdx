---
layout: ../../layouts/DocsLayout.astro
title: Authentication
---

import CodeBlock from '../../components/ui/CodeBlock.astro';
import Warning from '../../components/ui/Warning.astro';
import Note from '../../components/ui/Note.astro';

Authentication in Spooky is built directly into the sql schema, making it robust, typesafe, and dynamic. Because access control is defined at the database layer, your rules are consistently enforced regardless of how the data is accessed.

## Schema Configuration

You define authentication using `DEFINE ACCESS`. This allows you to specify exactly how users sign up and sign in, and what permissions they have.

<CodeBlock
  code={`-- Define access scope for accounts
DEFINE ACCESS account ON DATABASE TYPE RECORD
  SIGNUP ( 
    CREATE user 
    SET username = $username,
      password = crypto::argon2::generate($password)
  )
  SIGNIN (
    SELECT * FROM user 
    WHERE username = $username 
      AND crypto::argon2::compare(password, $password)
  )
  DURATION FOR TOKEN 15m, FOR SESSION 30d;

-- Permissions use the $auth variable to check the current user
DEFINE TABLE user SCHEMAFULL
PERMISSIONS
FOR update, delete WHERE id = $auth.id
FOR select, create WHERE true;`}
lang="sql"
/>

## Client-Side Authentication

Spooky provides a strongly-typed authentication service on the client. It integrates seamlessly with the schema definitions.

### Sign In

<CodeBlock
  code={`import { db } from './db';

// The second argument is typesafe based on your SIGNIN definition
await db.auth.signIn('account', {
username: 'spooky_user',
password: 'secure_password'
});`}
lang="typescript"
/>

### Sign Up

<CodeBlock
  code={`import { db } from './db';

await db.auth.signUp('account', {
username: 'new_user',
password: 'secure_password'
});`}
lang="typescript"
/>

### Sign Out

<CodeBlock
  code={`await db.auth.signOut();`}
  lang="typescript"
/>

### Reacting to Auth State

You can subscribe to authentication state changes to update your UI dynamically. The callback receives the user ID when authenticated, or `null` when signed out.

<CodeBlock
  code={`import { createSignal, onCleanup } from 'solid-js';

function MyComponent() {
  const [userId, setUserId] = createSignal<string | null>(null);
  
  // Subscribe to auth state changes
  const unsubscribe = db.auth.subscribe((uid) => {
    setUserId(uid);
    if (uid) {
      console.log('User logged in:', uid);
    } else {
      console.log('User logged out');
    }
  });
  
  // Clean up subscription
  onCleanup(() => unsubscribe());
  
  return <div>User ID: {userId() || 'Not logged in'}</div>;
}`}
  lang="typescript"
/>

## Third-Party Providers

### Clerk

<Note>Integration coming soon.</Note>

### Firebase

<Note>Integration coming soon.</Note>

### Auth0

<Note>Integration coming soon.</Note>
