// ⚠️  WARNING: This file is automatically generated by syncgen.
// Do not modify this file manually as changes will be overwritten.
// To regenerate this file, run the syncgen command from the database package.
// Generated on: 2025-10-27 13:55:39 UTC

export interface Schema {
    comment: Comment;
    thread:  Thread;
    user:    User;
    [property: string]: any;
}

export interface Comment {
    /**
     * Record ID of table: user
     */
    author: string;
    /**
     * Assert: $value != NONE AND string::len($value) > 0
     */
    content:     string;
    created_at?: Date;
    /**
     * Record ID
     */
    id: string;
    /**
     * Record ID of table: thread
     */
    thread_id: string;
    [property: string]: any;
}

export interface Thread {
    /**
     * Record ID of table: user
     */
    author:    string;
    comments?: string[] | null;
    /**
     * Assert: $value != NONE AND string::len($value) > 0
     */
    content:     string;
    created_at?: Date;
    /**
     * Record ID
     */
    id: string;
    /**
     * Assert: $value != NONE AND string::len($value) > 0 AND string::len($value) <= 200
     */
    title: string;
    [property: string]: any;
}

export interface User {
    comments?:   string[] | null;
    created_at?: Date;
    /**
     * Record ID
     */
    id: string;
    /**
     * Assert: $value != NONE AND string::len($value) > 0
     */
    password: string;
    /**
     * Assert: $value != NONE AND string::is::alphanum($value) AND string::len($value) > 3
     */
    username: string;
    [property: string]: any;
}

/**
 * Relationships between tables
 * Maps each table name to an array of relationships with field and table info
 */
export interface Relationship {
    /** The field name that creates this relationship */
    field: string;
    /** The related table name */
    table: string;
}

export interface Relationships {
    user: Relationship[];
    comment: Relationship[];
    thread: Relationship[];
}

/**
 * Relationship data extracted from the schema
 * Maps each table to its relationships with field and target table info
 */
export const RELATIONSHIPS: Relationships = {
    user: [
        { field: "comments", table: "comment" },
    ],
    thread: [
        { field: "comments", table: "comment" },
        { field: "author", table: "user" },
    ],
    comment: [
        { field: "thread_id", table: "thread" },
        { field: "author", table: "user" },
    ],
};


/**
 * The complete SurrealDB schema definition.
 * This constant contains the raw .surql schema file content.
 */
export const SURQL_SCHEMA = `-- ##################################################################
-- SCOPES & AUTHENTICATION
-- ##################################################################
DEFINE ACCESS account ON DATABASE TYPE RECORD
	SIGNUP ( CREATE user SET username = $username, password = crypto::argon2::generate($password) )
	SIGNIN ( SELECT * FROM user WHERE username = $username AND crypto::argon2::compare(password, $password) )
	DURATION FOR TOKEN 15m, FOR SESSION 12h
;

-- ##################################################################
-- USER TABLE
-- ##################################################################

DEFINE TABLE user SCHEMAFULL
  PERMISSIONS FOR select, update, delete, create
  WHERE $access = "account"
  AND id = $auth.id
;

DEFINE FIELD username ON TABLE user TYPE string
    ASSERT $value != NONE AND string::is::alphanum($value) AND string::len($value) > 3;
    
DEFINE INDEX unique_username ON TABLE user FIELDS username UNIQUE;

DEFINE FIELD password ON TABLE user TYPE string
    ASSERT $value != NONE AND string::len($value) > 0;

DEFINE FIELD created_at ON TABLE user TYPE datetime
    VALUE time::now();

DEFINE FIELD comments ON TABLE user TYPE option<array<record<comment>>> REFERENCE;

-- ##################################################################
-- THREAD TABLE
-- ##################################################################

DEFINE TABLE thread SCHEMAFULL
  PERMISSIONS
    FOR select WHERE true
    FOR update, delete, create WHERE $access = "account" AND author.id = $auth.id
;


DEFINE FIELD title ON TABLE thread TYPE string
    ASSERT $value != NONE AND string::len($value) > 0 AND string::len($value) <= 200;

DEFINE FIELD content ON TABLE thread TYPE string
    ASSERT $value != NONE AND string::len($value) > 0;

DEFINE FIELD author ON TABLE thread TYPE record<user>;

DEFINE FIELD created_at ON TABLE thread TYPE datetime
    VALUE time::now();

DEFINE FIELD comments ON TABLE thread TYPE option<array<record<comment>>> REFERENCE;

-- ##################################################################
-- COMMENT TABLE
-- ##################################################################

DEFINE TABLE comment SCHEMAFULL
  PERMISSIONS
    FOR select WHERE true
    FOR update, delete, create WHERE $access = "account" AND author.id = $auth.id
;

DEFINE FIELD thread_id ON TABLE comment TYPE record<thread>;

DEFINE FIELD content ON TABLE comment TYPE string
    ASSERT $value != NONE AND string::len($value) > 0;

DEFINE FIELD author ON TABLE comment TYPE record<user>;

DEFINE FIELD created_at ON TABLE comment TYPE datetime
    VALUE time::now();

`;
