
> @spooky/tests@0.0.0 test /Users/khadim/dev/spooky/tests
> jest --runInBand surrealdb/dbsp.test.ts

  console.log
    Starting SurrealDB container...

      at getContainer (surrealdb/setup.ts:17:11)


 .d8888b.                                             888 8888888b.  888888b.
d88P  Y88b                                            888 888  'Y88b 888  '88b
Y88b.                                                 888 888    888 888  .88P
 'Y888b.   888  888 888d888 888d888  .d88b.   8888b.  888 888    888 8888888K.
    'Y88b. 888  888 888P'   888P'   d8P  Y8b     '88b 888 888    888 888  'Y88b
      '888 888  888 888     888     88888888 .d888888 888 888    888 888    888
Y88b  d88P Y88b 888 888     888     Y8b.     888  888 888 888  .d88P 888   d88P
 'Y8888P'   'Y88888 888     888      'Y8888  'Y888888 888 8888888P'  8888888P'


[2m2025-12-30T20:27:23.053287Z[0m [32m INFO[0m [2msurrealdb_server::env[0m[2m:[0m Running 3.0.0-alpha.17 for linux on aarch64
[2m2025-12-30T20:27:23.077807Z[0m [34mDEBUG[0m [1minit[0m: [2msurrealdb_server::dbs[0m[2m:[0m Server capabilities: scripting=true, guest_access=true, live_query_notifications=true, allow_funcs=all, deny_funcs=none, allow_net=all, deny_net=none, allow_rpc=all, deny_rpc=none, allow_http=all, deny_http=none, allow_experimental=all, deny_experimental=none, allow_arbitrary_query=all, deny_arbitrary_query=none
[2m2025-12-30T20:27:23.077835Z[0m [32m INFO[0m [1minit[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Starting kvs store in memory
[2m2025-12-30T20:27:23.078704Z[0m [32m INFO[0m [1minit[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Started kvs store in memory
[2m2025-12-30T20:27:23.098062Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"check_version" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.098074Z[0m [32m INFO[0m [1minit[0m:[1minitialise_defaults[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m This is a new SurrealDB instance. Initialising default namespace 'main' and database 'main'
[2m2025-12-30T20:27:23.098088Z[0m [35mTRACE[0m [1minit[0m:[1minitialise_defaults[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3minput[0m[2m=[0m"\n\t\t\tDEFINE NAMESPACE $namespace COMMENT 'Default namespace generated by SurrealDB'; \n\t\t\tUSE NS $namespace;\n\t\t\tDEFINE DATABASE $database COMMENT 'Default database generated by SurrealDB'; \n\t\t\tDEFINE CONFIG DEFAULT NAMESPACE $namespace DATABASE $database;\n\t\t" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m256[0m
[2m2025-12-30T20:27:23.098413Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"initialise_defaults" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.098422Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Initialising credentials [3muser[0m[2m=[0mroot
[2m2025-12-30T20:27:23.098437Z[0m [32m INFO[0m [1minit[0m:[1minitialise_credentials[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Credentials were provided, and no root users were found. The root user 'root' will be created
[2m2025-12-30T20:27:23.112158Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"initialise_credentials" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.112171Z[0m [35mTRACE[0m [1minit[0m:[1minsert_node[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Inserting node in the cluster [3mid[0m[2m=[0mca448b51-a2b6-49ce-bddd-4f1cbdf91692
[2m2025-12-30T20:27:23.126141Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Insert node" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.126155Z[0m [35mTRACE[0m [1minit[0m:[1mexpire_nodes[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Archiving expired nodes in the cluster
[2m2025-12-30T20:27:23.126184Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Expire nodes" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.126194Z[0m [35mTRACE[0m [1minit[0m:[1mremove_nodes[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Cleaning up archived nodes in the cluster
[2m2025-12-30T20:27:23.126208Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Remove nodes" [3mattempts[0m[2m=[0m1
[2m2025-12-30T20:27:23.126250Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Updating node registration information every 3s
[2m2025-12-30T20:27:23.126268Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Processing and cleaning archived nodes every 300s
[2m2025-12-30T20:27:23.126271Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Processing and archiving inactive nodes every 15s
[2m2025-12-30T20:27:23.126276Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Running changefeed garbage collection every 30s
[2m2025-12-30T20:27:23.126278Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Running index compaction every 5s
[2m2025-12-30T20:27:23.126405Z[0m [32m INFO[0m [2msurrealdb::net[0m[2m:[0m Started web server on 0.0.0.0:8000
[2m2025-12-30T20:27:23.126419Z[0m [32m INFO[0m [2msurrealdb::net[0m[2m:[0m Listening for a system shutdown signal.
[2m2025-12-30T20:27:23.126315Z[0m [33m WARN[0m [2msurrealdb_server::ntw[0m[2m:[0m ‚ùåüîíIMPORTANT: GraphQL is a pre-release feature with known security flaws. This is not recommended for production use.üîí‚ùå
  console.log
    SurrealDB started on port 56429

      at getContainer (surrealdb/setup.ts:62:11)

[2m2025-12-30T20:27:23.144565Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3453f2d0-e4ce-40ee-8484-88b34bde8d65" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.144659Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3453f2d0-e4ce-40ee-8484-88b34bde8d65" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-30T20:27:23.153453Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"754df84a-ae40-45db-a211-cbc1ee7a6103" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.167597Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::signin[0m[2m:[0m Signing in as root [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"754df84a-ae40-45db-a211-cbc1ee7a6103" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.167648Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"754df84a-ae40-45db-a211-cbc1ee7a6103" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m14[0m
[2m2025-12-30T20:27:23.170390Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.170410Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.170429Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.170471Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.170523Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"REMOVE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
[2m2025-12-30T20:27:23.170615Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a70ca602-e310-4ce2-b136-8558c8ff3ff8" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-30T20:27:23.173340Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.173367Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.173386Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.173436Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.173476Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"DEFINE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
  console.log
    Loading generated schema from: /Users/khadim/dev/spooky/tests/.spooky/schema.gen.surql

      at createTestDb (surrealdb/setup.ts:100:13)

[2m2025-12-30T20:27:23.173692Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8131717a-ff0c-45a9-bf14-520d242cccc0" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-30T20:27:23.175958Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.175977Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.175991Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.176023Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.176170Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"-- This file is auto-generated. Do not edit manually.\n-- Generated by syncgen - any changes will be overwritten.\n\n\n-- ==================================================\n-- SURREALISM MODULES\n-- ==================================================\n\n-- Define bucket for module files\nDEFINE BUCKET IF NOT EXISTS modules BACKEND \"file:///modules\";\n\n-- Define the XOR module\nDEFINE MODULE mod::xor AS f\"modules:/xor_module.surli\";\n\n-- Define the DBSP module\nDEFINE MODULE mod::dbsp AS f\"modules:/dbsp_module.surli\";\n\n-- ##################################################################\n-- SCOPES & AUTHENTICATION\n-- ##################################################################\nDEFINE ACCESS account ON DATABASE TYPE RECORD\nSIGNUP {\n  IF string::len($username) <= 3 { THROW \"Username must be longer than 3 characters\" };\n  IF string::len($password) == 0 { THROW \"Password cannot be empty\" };\n\n  LET $existing = (SELECT value id FROM user WHERE username = $username LIMIT 1)[0];\n  IF $existing != NONE { THROW \"Username '\" + <string>$username + \"' is already taken\" };\n\n  LET $u = CREATE user SET username = $username, password = crypto::argon2::generate($password);\n  RETURN $u;\n}\nSIGNIN ( SELECT * FROM user WHERE username = $username AND crypto::argon2::compare(password, $password) )\nDURATION FOR TOKEN 365d, FOR SESSION 365d\n;\n\nDEFINE FUNCTION fn::polyfill::createAccount($username: string, $password: string) {\n  IF string::len($username) <= 3 { THROW \"Username must be longer than 3 characters\" };\n  IF string::len($password) == 0 { THROW \"Password cannot be empty\" };\n\n  LET $existing = (SELECT value id FROM user WHERE username = $username LIMIT 1)[0];\n  IF $existing != NONE { THROW \"Username '\" + <string>$username + \"' is already taken\" };\n\n  LET $u = CREATE user SET username = $username, password = crypto::argon2::generate($password);\n  RETURN $u;\n};\n\n-- ##################################################################\n-- USER TABLE\n-- ##################################################################\n\nDEFINE TABLE user SCHEMAFULL\nPERMISSIONS\n  FOR update, delete WHERE $access = \"account\" AND id = $auth.id\n  FOR create, select WHERE true;\n\nDEFINE FIELD username ON TABLE user TYPE string\nASSERT $value != NONE AND string::len($value) > 3\nPERMISSIONS\n    FOR select WHERE true\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n    \nDEFINE INDEX unique_username ON TABLE user FIELDS username UNIQUE;\n\nDEFINE FIELD password ON TABLE user TYPE string\nASSERT $value != NONE AND string::len($value) > 0\nPERMISSIONS\n    FOR select WHERE false\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n\nDEFINE FIELD created_at ON TABLE user TYPE datetime\nVALUE time::now()\nPERMISSIONS\n    FOR select WHERE false\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n\n-- ##################################################################\n-- THREAD TABLE\n-- ##################################################################\n\nDEFINE TABLE thread SCHEMAFULL\n  PERMISSIONS\n    FOR select WHERE true\n    FOR update, delete, create WHERE $access = \"account\" AND author.id = $auth.id\n;\n\n\nDEFINE FIELD title ON TABLE thread TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0 AND string::len($value) <= 200;\n\nDEFINE FIELD content ON TABLE thread TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0;\n\nDEFINE FIELD author ON TABLE thread TYPE record<user>; -- @parent\n\nDEFINE FIELD created_at ON TABLE thread TYPE datetime\n    VALUE time::now();\n\nDEFINE FIELD active ON TABLE thread TYPE bool VALUE $value OR false;\n\n-- ##################################################################\n-- COMMENT TABLE\n-- ##################################################################\n\nDEFINE TABLE comment SCHEMAFULL\n  PERMISSIONS\n    FOR select WHERE true\n    FOR update, delete, create WHERE $access = \"account\" AND author.id = $auth.id\n;\n\nDEFINE FIELD thread ON TABLE comment TYPE record<thread>; -- @parent\n\nDEFINE FIELD content ON TABLE comment TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0;\n\nDEFINE FIELD author ON TABLE comment TYPE record<user>;\n\nDEFINE FIELD created_at ON TABLE comment TYPE datetime\n    VALUE time::now();\n\n-- ##################################################################\n-- RELATION TABLES\n-- ##################################################################\n\nDEFINE TABLE commented_on SCHEMAFULL TYPE RELATION\n  FROM comment TO thread\n  PERMISSIONS FOR select WHERE true;\n\nDEFINE EVENT comment_created ON TABLE comment WHEN $event = \"CREATE\" THEN\n  RELATE ($after.id)->commented_on->($after.thread)\n;\n-- ==================================================\n-- SPOOKY INCANTATION\n-- The Registry of active Live Queries (Incantations).\n-- ==================================================\n\nDEFINE TABLE _spooky_incantation SCHEMALESS\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- The raw query string (for re-hydration/debugging)\n-- The raw query string (for re-hydration/debugging)\nDEFINE FIELD surrealQL ON TABLE _spooky_incantation TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- The raw query string (for re-hydration/debugging)\nDEFINE FIELD clientId ON TABLE _spooky_incantation TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- The current XOR sum of all results in this query\nDEFINE FIELD hash ON TABLE _spooky_incantation TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- The Radix Tree of Result IDs for efficient sync\nDEFINE FIELD tree ON TABLE _spooky_incantation TYPE any\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- For garbage collection (Heartbeat)\nDEFINE FIELD lastActiveAt ON TABLE _spooky_incantation TYPE datetime DEFAULT time::now()\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n-- How long this Incantation stays alive without activity\nDEFINE FIELD ttl ON TABLE _spooky_incantation TYPE duration\n    PERMISSIONS FOR select, create, update WHERE $_spooky_client_id = $clientId;\n\n\n-- Remote-only meta tables (not synced to client)\nDEFINE TABLE _spooky_module_state SCHEMALESS PERMISSIONS FULL;\n\n-- Unregister from DBSP on deletion\nDEFINE EVENT _spooky_dbsp_cleanup ON TABLE _spooky_incantation WHEN $event = \"DELETE\" THEN {\n    let $result = mod::dbsp::unregister_query(<string>$before.id);\n};\n\n-- Register with DBSP on creation or update\n-- Register with DBSP on creation or update\nDEFINE EVENT _spooky_dbsp_register ON TABLE _spooky_incantation WHEN $event = \"CREATE\" OR ($event = \"UPDATE\" AND ($after.surrealQL != $before.surrealQL OR $after.params != $before.params)) THEN {\n    LET $res = mod::dbsp::register_view(<string>$after.id, $after.surrealQL, <string>($after.params OR {}));\n    -- Update the incantation with the initial hash computed by DBSP\n    IF $res.result_hash != NONE THEN {\n        UPDATE _spooky_incantation SET hash = $res.result_hash, tree = $res.tree WHERE id = $after.id; \n    } END;\n};\n-- ==================================================\n-- FUNCTION: CALCULATE VIEW HASH\n-- Usage: fn::spooky::view_hash(thread:123, ['comments'])\n-- ==================================================\nDEFINE FUNCTION fn::spooky::view_hash($rid: record, $paths: array<string>) {\n    LET $shadow = (SELECT * FROM ONLY _spooky_data_hash WHERE recordId = $rid);\n    IF $shadow.recordId == NONE { RETURN crypto::blake3(\"\"); };\n\n    -- 1. Start with the Intrinsic Hash\n    LET $parts = [$shadow.intrinsicHash];\n\n    -- 2. Collect requested Composition Hashes (if they exist)\n    -- We use a subquery to map the $paths array to values safely\n    LET $extras = (\n        SELECT VALUE $shadow.compositionHash[$this] \n        FROM $paths \n        WHERE $shadow.compositionHash[$this] != NONE\n    );\n\n    -- 3. Combine and Aggregate\n    LET $all_parts = array::concat($parts, $extras);\n    \n    RETURN mod::xor::blake3_xor_multi($all_parts);\n};\n\n-- ==================================================\n-- FUNCTION: REGISTER INCANTATION (With Sorting)\n-- Usage: fn::incantation::register({ ... sort_field: 'created_at' ... })\n-- ==================================================\nDEFINE FUNCTION fn::incantation::register($config: object) {\n    -- UNPACK CONFIG\n    LET $id         = $config.id;\n    LET $client_id   = $config.client_id;\n    LET $items      = $config.items;\n    LET $paths      = $config.paths;\n    LET $table      = $config.table;\n    LET $filter     = $config.filter;\n    LET $query      = $config.query; -- Optional DBSP Plan (SQL String)\n    \n    -- Sorting Params (Default to created_at if missing)\n    LET $sort_field = $config.sort_field OR 'created_at';\n    LET $tree_init = {}; \n    \n    -- 1. CALCULATE AGGREGATE HASH\n    LET $hashes = (\n        SELECT VALUE fn::spooky::view_hash(id, $paths) \n        FROM $items\n    );\n    LET $query_hash = mod::xor::blake3_xor_multi($hashes);\n\n    -- 2. UPDATE INCANTATION REGISTRY\n    -- Use String Cast for ID to avoid type::thing issues during schema load\n    LET $rid_str = \"_spooky_incantation:\" + $id;\n    LET $rid = <record>$rid_str;\n    \n    INSERT INTO _spooky_incantation {\n        id:           $rid,\n        hash:         $query_hash,\n        clientId:     $client_id,\n        surrealQL:    $query,\n        tree:         <object>{},\n        lastActiveAt: time::now(),\n        ttl:          1h\n    };\n\n\n\n    -- 5. REGISTER WITH DBSP (If plan provided)\n    IF $query != NONE THEN {\n        LET $state = fn::dbsp::get_state();\n        LET $dbsp_res = mod::dbsp::register_query($id, $query, $state);\n        fn::dbsp::save_state($dbsp_res.new_state);\n        \n        LET $init_res = $dbsp_res.result;\n        IF $init_res != NONE THEN {\n            -- Update using the explicit ID\n            UPDATE $rid SET hash = $init_res.hash, tree = $init_res.tree;\n        } END;\n        \n        -- DEBUG: Return the entire result to inspect state\n        RETURN $dbsp_res;\n    } END;\n\n    RETURN $query_hash;\n};\n\nDEFINE FUNCTION fn::incantation::heartbeat($id: record) {\n    UPDATE $id SET lastActiveAt = time::now();\n};\n-- ==================================================\n-- AUTO-GENERATED SPOOKY EVENTS\n-- ==================================================\n\n-- Meta Table: _spooky_data_hash Mutation\n-- Automatically recalculates TotalHash when IntrinsicHash or CompositionHash changes\nDEFINE EVENT OVERWRITE _spooky_data_hash_mutation ON TABLE _spooky_data_hash\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $new_total = mod::xor::blake3_xor($after.intrinsicHash, $after.compositionHash._xor);\n    IF $new_total != $after.totalHash THEN {\n        UPDATE $after.id SET totalHash = $new_total;\n    } END;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE comment TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: comment Cascade Down (Reference Propagation)\n-- Table: comment Mutation\nDEFINE EVENT OVERWRITE _spooky_comment_mutation ON TABLE comment\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $ref_hash_author = IF $after.author != NONE THEN (SELECT totalHash FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.author)))[0].totalHash ELSE crypto::blake3(\"\") END;\n    LET $ref_hash_author = IF $ref_hash_author != NONE THEN $ref_hash_author ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $ref_hash_author);\n    LET $h_content = crypto::blake3(<string>$after.content OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_content);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$record_id)))[0];\n    LET $new_composition = {\n        author: $ref_hash_author,\n        _xor: $xor_composition,\n    };\n\n    LET $new_total_calculated = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        author: <string>($after.author OR \"\"),\n        content: $after.content,\n        created_at: <string>($after.created_at OR \"\"),\n        thread: <string>($after.thread OR \"\"),\n        IntrinsicHash: $new_total_calculated,\n        _hash: $new_total_calculated,\n        totalHash: $new_total_calculated,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('comment', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.id));\n    UPSERT $hash_id CONTENT {\n        recordId: $after.id,\n        intrinsicHash: $xor_intrinsic,\n        compositionHash: $new_composition,\n        totalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n    LET $new_total = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $old_total = IF $old_hash_data.recordId != NONE THEN $old_hash_data.totalHash ELSE $new_total END;\n    LET $old_total_for_delta = IF $old_hash_data.recordId != NONE THEN $old_hash_data.totalHash ELSE crypto::blake3(\"\") END;\n    -- BUBBLE UP to Parent (thread)\n    IF $before.thread = $after.thread THEN {\n        LET $delta = mod::xor::blake3_xor($old_total_for_delta, $new_total_calculated);\n        UPDATE _spooky_data_hash SET\n            compositionHash.comment = mod::xor::blake3_xor((compositionHash.comment OR $empty_hash), $delta),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $delta)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.thread));\n    } ELSE {\n        UPDATE _spooky_data_hash SET\n            compositionHash.comment = mod::xor::blake3_xor((compositionHash.comment OR $empty_hash), $old_total_for_delta),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $old_total_for_delta)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.thread)) AND id != NONE;\n\n        UPDATE _spooky_data_hash SET\n            compositionHash.comment = mod::xor::blake3_xor((compositionHash.comment OR $empty_hash), $new_total_calculated),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $new_total_calculated)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.thread)) AND id != NONE;\n    } END;\n\n};\n\n-- Table: comment Deletion\nDEFINE EVENT OVERWRITE _spooky_comment_delete ON TABLE comment\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        author: <string>($before.author OR \"\"),\n        content: $before.content,\n        created_at: <string>($before.created_at OR \"\"),\n        thread: <string>($before.thread OR \"\"),\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('comment', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id)))[0];\n    LET $old_total = $old_hash_data.totalHash;\n\n    -- BUBBLE UP Delete to Parent\n    IF $old_total != NONE AND $before.thread != NONE THEN {\n        UPDATE _spooky_data_hash SET\n            compositionHash.comment = mod::xor::blake3_xor((compositionHash.comment OR $empty_hash), $old_total),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $old_total)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.thread));\n    } END;\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id));\n    DELETE $hash_id;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE thread TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: thread Cascade Down (Reference Propagation)\nDEFINE EVENT _spooky_z_cascade_comment_thread ON TABLE thread\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE comment SET _spooky_touch = time::now() WHERE thread = $after.id;\n};\n\n-- Table: thread Mutation\nDEFINE EVENT OVERWRITE _spooky_thread_mutation ON TABLE thread\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $h_active = crypto::blake3(<string>$after.active OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_active);\n    LET $h_content = crypto::blake3(<string>$after.content OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_content);\n    LET $h_title = crypto::blake3(<string>$after.title OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_title);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$record_id)))[0];\n    LET $h_comment = IF $old_hash_data.recordId != NONE THEN $old_hash_data.compositionHash.comment ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $h_comment);\n    LET $new_composition = {\n        comment: $h_comment,\n        _xor: $xor_composition,\n    };\n\n    LET $new_total_calculated = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        active: $after.active,\n        author: <string>($after.author OR \"\"),\n        content: $after.content,\n        created_at: <string>($after.created_at OR \"\"),\n        title: $after.title,\n        IntrinsicHash: $new_total_calculated,\n        _hash: $new_total_calculated,\n        totalHash: $new_total_calculated,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('thread', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.id));\n    UPSERT $hash_id CONTENT {\n        recordId: $after.id,\n        intrinsicHash: $xor_intrinsic,\n        compositionHash: $new_composition,\n        totalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n    LET $new_total = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $old_total = IF $old_hash_data.recordId != NONE THEN $old_hash_data.totalHash ELSE $new_total END;\n    LET $old_total_for_delta = IF $old_hash_data.recordId != NONE THEN $old_hash_data.totalHash ELSE crypto::blake3(\"\") END;\n    -- BUBBLE UP to Parent (author)\n    IF $before.author = $after.author THEN {\n        LET $delta = mod::xor::blake3_xor($old_total_for_delta, $new_total_calculated);\n        UPDATE _spooky_data_hash SET\n            compositionHash.thread = mod::xor::blake3_xor((compositionHash.thread OR $empty_hash), $delta),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $delta)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.author));\n    } ELSE {\n        UPDATE _spooky_data_hash SET\n            compositionHash.thread = mod::xor::blake3_xor((compositionHash.thread OR $empty_hash), $old_total_for_delta),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $old_total_for_delta)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.author)) AND id != NONE;\n\n        UPDATE _spooky_data_hash SET\n            compositionHash.thread = mod::xor::blake3_xor((compositionHash.thread OR $empty_hash), $new_total_calculated),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $new_total_calculated)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.author)) AND id != NONE;\n    } END;\n\n};\n\n-- Table: thread Deletion\nDEFINE EVENT OVERWRITE _spooky_thread_delete ON TABLE thread\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        active: $before.active,\n        author: <string>($before.author OR \"\"),\n        content: $before.content,\n        created_at: <string>($before.created_at OR \"\"),\n        title: $before.title,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('thread', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id)))[0];\n    LET $old_total = $old_hash_data.totalHash;\n\n    -- BUBBLE UP Delete to Parent\n    IF $old_total != NONE AND $before.author != NONE THEN {\n        UPDATE _spooky_data_hash SET\n            compositionHash.thread = mod::xor::blake3_xor((compositionHash.thread OR $empty_hash), $old_total),\n            compositionHash._xor = mod::xor::blake3_xor(compositionHash._xor, $old_total)\n        WHERE id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.author));\n    } END;\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id));\n    DELETE $hash_id;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE user TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: user Cascade Down (Reference Propagation)\nDEFINE EVENT _spooky_z_cascade_comment_author ON TABLE user\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE comment SET _spooky_touch = time::now() WHERE author = $after.id;\n};\n\nDEFINE EVENT _spooky_z_cascade_thread_author ON TABLE user\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE thread SET _spooky_touch = time::now() WHERE author = $after.id;\n};\n\n-- Table: user Mutation\nDEFINE EVENT OVERWRITE _spooky_user_mutation ON TABLE user\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $h_username = crypto::blake3(<string>$after.username OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_username);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$record_id)))[0];\n    LET $h_thread = IF $old_hash_data.recordId != NONE THEN $old_hash_data.compositionHash.thread ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $h_thread);\n    LET $new_composition = {\n        thread: $h_thread,\n        _xor: $xor_composition,\n    };\n\n    LET $new_total_calculated = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        created_at: <string>($after.created_at OR \"\"),\n        password: $after.password,\n        username: $after.username,\n        IntrinsicHash: $new_total_calculated,\n        _hash: $new_total_calculated,\n        totalHash: $new_total_calculated,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('user', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$after.id));\n    UPSERT $hash_id CONTENT {\n        recordId: $after.id,\n        intrinsicHash: $xor_intrinsic,\n        compositionHash: $new_composition,\n        totalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n    -- ==================================================\n    -- CASCADE DOWN (Disabled for Object Hash for now)\n    -- Logic: {} Change -> Updates Dependent INTRINSIC Hash\n    -- ==================================================\n    -- (Skipped implementation for object hash)\n\n};\n\n-- Table: user Deletion\nDEFINE EVENT OVERWRITE _spooky_user_delete ON TABLE user\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        created_at: <string>($before.created_at OR \"\"),\n        password: $before.password,\n        username: $before.username,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('user', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_incantation SET hash = $u.result_hash, tree = $u.tree WHERE id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id)))[0];\n    LET $old_total = $old_hash_data.totalHash;\n\n    LET $hash_id = <record>(\"_spooky_data_hash:\" + crypto::blake3(<string>$before.id));\n    DELETE $hash_id;\n};\n\n" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m25361[0m
[2m2025-12-30T20:27:23.176970Z[0m [34mDEBUG[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::iam::file[0m[2m:[0m Allowed bucket folder path: /modules [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.180295Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"25408" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cbfd53b8-2e50-4da9-8a36-276980cc1f52" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m4[0m
[2m2025-12-30T20:27:23.185980Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.186017Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.186042Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.186106Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:23.186158Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"RETURN mod::dbsp::reset({})" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m27[0m
[2m2025-12-30T20:27:23.186208Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::reset' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.128337Z[0m [35mTRACE[0m [1mupdate_node[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Updating node in the cluster [3mid[0m[2m=[0mca448b51-a2b6-49ce-bddd-4f1cbdf91692
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.630142Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"DELETE _spooky_module_state:dbsp" [3mlength[0m[2m=[0m32[0m [2m[3minput[0m[2m=[0m"DELETE _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m32[0m
[2m2025-12-30T20:27:26.630197Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mDELETE _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.630467Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"cfd952e3-3c12-4b5e-9f5a-c643531b1aac" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m3444[0m
[2m2025-12-30T20:27:26.635845Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.635861Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.635875Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.635989Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.636047Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_users_incr\", \"SELECT * FROM users_incr WHERE id = 'users_incr:active:1'\", {});\n            \n            LET $r2 = mod::dbsp::ingest(\"users_incr\", \"CREATE\", \"users_incr:active:1\", { name: \"Alice\", active: true, hash: \"0000\" });\n            RETURN $r2.updates;\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m321[0m
[2m2025-12-30T20:27:26.636127Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.636735Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.636778Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.636896Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m313[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m313[0m
[2m2025-12-30T20:27:26.636929Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.637231Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(true), "hash": String("0000"), "name": String("Alice")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.637823Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.637860Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_users_incr, delta_len=1, hash=2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f, last_hash=
[2m2025-12-30T20:27:26.638136Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m543[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m543[0m
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.638212Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}}]}'
üü¢ Async body completed for: __sr_sql
  console.log
    DEBUG: res2: [null,null,[{"query_id":"view_users_incr","result_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","result_ids":["users_incr:active:1"],"tree":{"hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","leaves":[{"hash":"0000","id":"users_incr:active:1"}]}}]]

      at Object.<anonymous> (surrealdb/dbsp.test.ts:49:13)

[2m2025-12-30T20:27:26.638741Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"368" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"c8555c36-344d-4496-9353-d8deb3116fe0" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m2[0m
[2m2025-12-30T20:27:26.643947Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.643965Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.643982Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.644025Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.644065Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_users_active\", \"SELECT * FROM users WHERE id = 'users:active*'\", {});\n            \n            LET $r2 = mod::dbsp::register_view(\"view_threads_recent\", \"SELECT * FROM threads WHERE id = 'threads:2024*'\", {});\n            \n            LET $u_res = mod::dbsp::ingest(\"users\", \"CREATE\", \"users:active:99\", {\"name\":\"Bob\",\"active\":true,\"hash\":\"0000\"});\n            \n            LET $t_res = mod::dbsp::ingest(\"threads\", \"CREATE\", \"threads:2024:1\", {\"title\":\"Hello\",\"hash\":\"0000\"});\n            \n            RETURN {\n                user_updates: $u_res.updates,\n                thread_updates: $t_res.updates\n            };\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m682[0m
[2m2025-12-30T20:27:26.644124Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.644866Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.644912Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.645173Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m732[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m732[0m
[2m2025-12-30T20:27:26.645209Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.645495Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.645997Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.646020Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.646260Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m925[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m925[0m
[2m2025-12-30T20:27:26.646293Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.646567Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(true), "hash": String("0000"), "name": String("Bob")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.646942Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.646963Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_users_active, delta_len=1, hash=38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.647354Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m1132[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m1132[0m
[2m2025-12-30T20:27:26.647458Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.647862Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "title": String("Hello")}
[2m2025-12-30T20:27:26.648304Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.648333Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_threads_recent, delta_len=1, hash=3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.648689Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m1329[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m1329[0m
[2m2025-12-30T20:27:26.648720Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.649140Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"729" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"12f411ab-8bae-42ca-859f-76dfeeacde3f" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m5[0m
[2m2025-12-30T20:27:26.652864Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.652886Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.652900Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.652937Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.652988Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"RETURN mod::dbsp::register_view(\"view_users_threads_join\", \"SELECT * FROM users, threads WHERE users.id = threads.author AND users.id = 'users:active*'\", {})" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m157[0m
[2m2025-12-30T20:27:26.653031Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.653722Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.653766Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.654148Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m1633[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m1633[0m
[2m2025-12-30T20:27:26.654218Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.654538Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"203" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a4517d31-2c4d-4a51-9733-4dedd5c6dfbd" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m1[0m
[2m2025-12-30T20:27:26.658337Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.658358Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.658372Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.658423Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.658462Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_tree_test\", \"SELECT * FROM tree_items WHERE id = 'item*'\", {});\n            \n            LET $r2 = mod::dbsp::ingest(\"tree_items\", \"CREATE\", \"item:1\", {\"id\":\"item:1\",\"val\":\"A\",\"hash\":\"0000\"});\n            \n            LET $r3 = mod::dbsp::ingest(\"tree_items\", \"CREATE\", \"item:2\", {\"id\":\"item:2\",\"val\":\"B\",\"hash\":\"0001\"});\n            \n            LET $r4 = mod::dbsp::ingest(\"tree_items\", \"DELETE\", \"item:1\", {\"id\":\"item:1\",\"val\":\"A\",\"hash\":\"0000\"});\n            \n            RETURN $r1;\n            RETURN $r2.updates;\n            RETURN $r3.updates;\n            RETURN $r4.updates;\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m646[0m
[2m2025-12-30T20:27:26.658530Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.659353Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.659407Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.659981Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m1816[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m1816[0m
[2m2025-12-30T20:27:26.660062Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.660547Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": String("item:1"), "val": String("A")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.661034Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.661060Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_tree_test, delta_len=1, hash=9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.661584Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:1\":1},\"rows\":{\"item:1\":{\"hash\":\"0000\",\"id\":\"item:1\",\"val\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:1\":1},\"last_hash\":\"9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2003[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:1\":1},\"rows\":{\"item:1\":{\"hash\":\"0000\",\"id\":\"item:1\",\"val\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:1\":1},\"last_hash\":\"9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2003[0m
[2m2025-12-30T20:27:26.661648Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:1":1},"rows":{"item:1":{"hash":"0000","id":"item:1","val":"A"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:1":1},"last_hash":"9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.662098Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0001"), "id": String("item:2"), "val": String("B")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.662627Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.662665Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_tree_test, delta_len=1, hash=e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51, last_hash=9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.663198Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:1\":1,\"item:2\":1},\"rows\":{\"item:1\":{\"hash\":\"0000\",\"id\":\"item:1\",\"val\":\"A\"},\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:1\":1,\"item:2\":1},\"last_hash\":\"e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2074[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:1\":1,\"item:2\":1},\"rows\":{\"item:1\":{\"hash\":\"0000\",\"id\":\"item:1\",\"val\":\"A\"},\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:1\":1,\"item:2\":1},\"last_hash\":\"e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2074[0m
[2m2025-12-30T20:27:26.663255Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:1":1,"item:2":1},"rows":{"item:1":{"hash":"0000","id":"item:1","val":"A"},"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:1":1,"item:2":1},"last_hash":"e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.663729Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": String("item:1"), "val": String("A")}
[2m2025-12-30T20:27:26.664226Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.664298Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_tree_test, delta_len=1, hash=7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6, last_hash=e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.664840Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2003[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2003[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.664887Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}}]}'
[2m2025-12-30T20:27:26.665414Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"694" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"4aa90f05-9936-4315-9ec3-21dda278e581" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m7[0m
  console.log
    DEBUG: Tree Test Results: [
      null,
      null,
      null,
      null,
      {
        "id": "view_tree_test",
        "msg": "Registered"
      },
      [
        {
          "query_id": "view_tree_test",
          "result_hash": "9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff",
          "result_ids": [
            "item:1"
          ],
          "tree": {
            "hash": "9d2b6ac856371f3eefe40e89602132d41c1ba3eed323132113707d982bc9b8ff",
            "leaves": [
              {
                "hash": "0000",
                "id": "item:1"
              }
            ]
          }
        }
      ],
      [
        {
          "query_id": "view_tree_test",
          "result_hash": "e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51",
          "result_ids": [
            "item:1",
            "item:2"
          ],
          "tree": {
            "hash": "e089d909b60cd87171b6c5cd6892be36867bc2149241822636cbc16ef475fa51",
            "leaves": [
              {
                "hash": "0000",
                "id": "item:1"
              },
              {
                "hash": "0000",
                "id": "item:2"
              }
            ]
          }
        }
      ],
      [
        {
          "query_id": "view_tree_test",
          "result_hash": "7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6",
          "result_ids": [
            "item:2"
          ],
          "tree": {
            "hash": "7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6",
            "leaves": [
              {
                "hash": "0000",
                "id": "item:2"
              }
            ]
          }
        }
      ]
    ]

      at Object.<anonymous> (surrealdb/dbsp.test.ts:131:13)

[2m2025-12-30T20:27:26.668418Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.668437Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.668455Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.668497Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.668553Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_join_sql\", \"SELECT * FROM users, posts WHERE users.id = posts.author\", {});\n            \n            LET $u = { id: 1, name: \"Alice\", hash: \"0000\" };\n            LET $r2 = mod::dbsp::ingest(\"users\", \"CREATE\", \"users:1\", $u);\n            \n            LET $p = { id: 10, author: 1, title: \"Hello\", hash: \"0001\" };\n            LET $r3 = mod::dbsp::ingest(\"posts\", \"CREATE\", \"posts:10\", $p);\n            \n            RETURN {\n                reg: $r1.msg,\n                user_updates: $r2.updates,\n                post_updates: $r3.updates\n            };\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m614[0m
[2m2025-12-30T20:27:26.668636Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.669554Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.669602Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.670105Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2217[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2217[0m
[2m2025-12-30T20:27:26.670163Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.670506Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(1), "name": String("Alice")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.670983Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.671019Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.671548Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2277[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2277[0m
[2m2025-12-30T20:27:26.671605Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.671897Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"author": Number(1), "hash": String("0001"), "id": Number(10), "title": String("Hello")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.672405Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.672430Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_join_sql, delta_len=1, hash=eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.672988Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2470[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2470[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.673034Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}}]}'
[2m2025-12-30T20:27:26.673474Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"662" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"540cdbc8-13a3-40b2-8fb4-9855d187d8ca" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m5[0m
[2m2025-12-30T20:27:26.676028Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.676048Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.676061Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.676093Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.676135Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_limit_eviction\", \"SELECT * FROM users_limit LIMIT 1\", {});\n            \n            // Ingest User A (id 20)\n            LET $u1 = { id: 20, name: \"A\", hash: \"0000\" };\n            LET $r2 = mod::dbsp::ingest(\"users_limit\", \"CREATE\", \"users_limit:20\", $u1);\n            \n            // Ingest User B (id 10 - smaller, should evict A)\n            LET $u2 = { id: 10, name: \"B\", hash: \"0001\" };\n            LET $r3 = mod::dbsp::ingest(\"users_limit\", \"CREATE\", \"users_limit:10\", $u2);\n            \n            RETURN {\n                up1: $r2.updates,\n                up2: $r3.updates\n            };\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m659[0m
[2m2025-12-30T20:27:26.676195Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.676902Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.676969Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.677614Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2638[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2638[0m
[2m2025-12-30T20:27:26.677673Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.678055Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(20), "name": String("A")}
[2m2025-12-30T20:27:26.678514Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.678542Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_limit_eviction, delta_len=1, hash=d9bc933647b22a251e773d68e4f97f58d1b5b21f15c414c3b9fecf70c273e64a, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.679230Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:20\":1},\"last_hash\":\"d9bc933647b22a251e773d68e4f97f58d1b5b21f15c414c3b9fecf70c273e64a\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2846[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:20\":1},\"last_hash\":\"d9bc933647b22a251e773d68e4f97f58d1b5b21f15c414c3b9fecf70c273e64a\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2846[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.679296Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:20":1},"last_hash":"d9bc933647b22a251e773d68e4f97f58d1b5b21f15c414c3b9fecf70c273e64a","params":{}}]}'
[2m2025-12-30T20:27:26.679865Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0001"), "id": Number(10), "name": String("B")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.680358Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.680385Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_limit_eviction, delta_len=2, hash=3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775, last_hash=d9bc933647b22a251e773d68e4f97f58d1b5b21f15c414c3b9fecf70c273e64a
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.681052Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m2917[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2917[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.681099Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}}]}'
[2m2025-12-30T20:27:26.681612Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"707" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"44893016-bb6d-4435-b2d2-2402f4c378ab" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m5[0m
[2m2025-12-30T20:27:26.683634Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.683652Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.683665Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.683699Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.683739Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_nested_limit\", \"SELECT *, (SELECT * FROM post WHERE author=$parent.id LIMIT 2) FROM user\", {});\n            RETURN $r1;\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m182[0m
[2m2025-12-30T20:27:26.683775Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.684472Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.684503Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.685101Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m3298[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m3298[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.685158Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{},"last_hash":"","params":{}}]}'
[2m2025-12-30T20:27:26.685605Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"229" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"8f23966f-2bb3-4c8c-8ad4-afeb2f7ccc1e" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m1[0m
[2m2025-12-30T20:27:26.687136Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.687159Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.687173Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.687220Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.687279Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r_v1 = mod::dbsp::register_view(\"view_active\", \"SELECT * FROM user WHERE status = 'active'\", {});\n            LET $r_v2 = mod::dbsp::register_view(\"view_u_p\", \"SELECT * FROM user, post WHERE user.id = post.author\", {});\n            LET $r_v3 = mod::dbsp::register_view(\"view_feed\", \"SELECT * FROM post LIMIT 3\", {});\n            \n            // ... Actions (same as before) ...\n            // Action 1: Create Users\n            LET $ua = { id: 1, status: 'active', hash: \"0000\" };\n            LET $ub = { id: 2, status: 'inactive', hash: \"0000\" };\n            \n            LET $r_a1 = mod::dbsp::ingest(\"user\", \"CREATE\", \"user:1\", $ua);\n            \n            LET $r_a2 = mod::dbsp::ingest(\"user\", \"CREATE\", \"user:2\", $ub);\n            \n            // Action 2: Posts for A\n            LET $p1 = { id: 10, author: 1, hash: \"0000\" };\n            LET $r_p1 = mod::dbsp::ingest(\"post\", \"CREATE\", \"post:10\", $p1);\n            \n            LET $p2 = { id: 11, author: 1, hash: \"0000\" };\n            LET $r_p2 = mod::dbsp::ingest(\"post\", \"CREATE\", \"post:11\", $p2);\n            \n            // Action 3: Update User B -> Active\n            LET $ub_active = { id: 2, status: 'active', hash: \"0001\" };\n            LET $r_upd = mod::dbsp::ingest(\"user\", \"UPDATE\", \"user:2\", $ub_active);\n            \n            // Action 4: Posts for B\n            LET $p3 = { id: 12, author: 2, hash: \"0000\" };\n            LET $r_p3 = mod::dbsp::ingest(\"post\", \"CREATE\", \"post:12\", $p3);\n            \n            LET $p4 = { id: 13, author: 2, hash: \"0000\" };\n            LET $r_p4 = mod::dbsp::ingest(\"post\", \"CREATE\", \"post:13\", $p4);\n            \n            // Action 5: Post 0 (Smallest ID)\n            // Use padded ID to ensure \"post:05\" < \"post:10\" lexicographically\n            LET $p0 = { id: 5, author: 1, hash: \"0000\" };\n            LET $r_p0 = mod::dbsp::ingest(\"post\", \"CREATE\", \"post:05\", $p0);\n            \n            RETURN {\n                user1: $r_a1.updates,\n                user2: $r_a2.updates,\n                post1: $r_p1.updates,\n                user_upt: $r_upd.updates,\n                post4: $r_p4.updates,\n                post0: $r_p0.updates\n            };\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m2193[0m
[2m2025-12-30T20:27:26.687385Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.688060Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.688103Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.688791Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m3486[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m3486[0m
[2m2025-12-30T20:27:26.688858Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.689292Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.689877Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.689909Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.690599Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m3693[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m3693[0m
[2m2025-12-30T20:27:26.690651Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.691006Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.691502Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.691545Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.692217Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m3844[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m3844[0m
[2m2025-12-30T20:27:26.692282Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.692781Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(1), "status": String("active")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.693286Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.693321Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_nested_limit, delta_len=1, hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52, last_hash=
DEBUG: process: view=view_active, delta_len=1, hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.694126Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4094[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4094[0m
[2m2025-12-30T20:27:26.694175Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"user":{"name":"user","zset":{"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.694819Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(2), "status": String("inactive")}
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.695400Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.695426Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_nested_limit, delta_len=1, hash=4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f, last_hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.696336Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4168[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4168[0m
[2m2025-12-30T20:27:26.696391Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"user":{"name":"user","zset":{"user:1":1,"user:2":1},"rows":{"user:2":{"hash":"0000","id":2,"status":"inactive"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":1},"last_hash":"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{},"last_hash":"","params":{}}]}'
[2m2025-12-30T20:27:26.697067Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
üü¢ Async body completed for: __sr_sql
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: normalize_record received direct record: Object {"author": Number(1), "hash": String("0000"), "id": Number(10)}
[2m2025-12-30T20:27:26.697561Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.697601Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_u_p, delta_len=1, hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52, last_hash=
DEBUG: process: view=view_feed, delta_len=1, hash=eeec759e956dd2902245d57e90b7f4285e88f84edd885f6dd92927efb13c4fa8, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.698530Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:10\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1},\"last_hash\":\"eeec759e956dd2902245d57e90b7f4285e88f84edd885f6dd92927efb13c4fa8\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4415[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:10\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1},\"last_hash\":\"eeec759e956dd2902245d57e90b7f4285e88f84edd885f6dd92927efb13c4fa8\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4415[0m
[2m2025-12-30T20:27:26.698595Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"user":{"name":"user","zset":{"user:1":1,"user:2":1},"rows":{"user:2":{"hash":"0000","id":2,"status":"inactive"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"post":{"name":"post","zset":{"post:10":1},"rows":{"post:10":{"author":1,"hash":"0000","id":10}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":1},"last_hash":"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1},"last_hash":"eeec759e956dd2902245d57e90b7f4285e88f84edd885f6dd92927efb13c4fa8","params":{}}]}'
üü¢ Async body completed for: __sr_sql
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_u_p, delta_len=1, hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52, last_hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52
DEBUG: process: view=view_feed, delta_len=1, hash=ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f, last_hash=eeec759e956dd2902245d57e90b7f4285e88f84edd885f6dd92927efb13c4fa8
[2m2025-12-30T20:27:26.699380Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"author": Number(1), "hash": String("0000"), "id": Number(11)}
[2m2025-12-30T20:27:26.699952Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.699982Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.700912Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":1,\"user:1\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":2},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1},\"last_hash\":\"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4484[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0000\",\"id\":2,\"status\":\"inactive\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":1,\"user:1\":1},\"last_hash\":\"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":2},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1},\"last_hash\":\"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4484[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.700975Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0000","id":2,"status":"inactive"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"post":{"name":"post","zset":{"post:11":1,"post:10":1},"rows":{"post:10":{"author":1,"hash":"0000","id":10},"post:11":{"author":1,"hash":"0000","id":11}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":1,"user:1":1},"last_hash":"4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":2},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:11":1},"last_hash":"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f","params":{}}]}'
[2m2025-12-30T20:27:26.701510Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0001"), "id": Number(2), "status": String("active")}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.702035Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.702065Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_nested_limit, delta_len=1, hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78, last_hash=4c881139ee4eb219f84699805751eac387952cd5594f2582aa681aec611a535f
DEBUG: process: view=view_active, delta_len=1, hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78, last_hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.703079Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":2},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1},\"last_hash\":\"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4493[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":2},\"last_hash\":\"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1},\"last_hash\":\"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4493[0m
[2m2025-12-30T20:27:26.703146Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"post":{"name":"post","zset":{"post:11":1,"post:10":1},"rows":{"post:11":{"author":1,"hash":"0000","id":11},"post:10":{"author":1,"hash":"0000","id":10}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":2},"last_hash":"aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:11":1},"last_hash":"ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.703839Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
DEBUG: normalize_record received direct record: Object {"author": Number(2), "hash": String("0000"), "id": Number(12)}
[2m2025-12-30T20:27:26.704315Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.704341Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_u_p, delta_len=1, hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78, last_hash=aacca82818e7ff18b6067e9233c6d5d54021fa1f5a9c2fe9b134ccc6c77a5c52
DEBUG: process: view=view_feed, delta_len=1, hash=7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec, last_hash=ac62479d17fff0733fd0a70b1f8aa9744fb5e93c3e015f33368c6dedebc7dd9f
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.705311Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:12\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":2,\"user:1\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:12\":1},\"last_hash\":\"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4573[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:12\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":2,\"user:1\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:12\":1},\"last_hash\":\"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4573[0m
[2m2025-12-30T20:27:26.705372Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"post":{"name":"post","zset":{"post:11":1,"post:10":1,"post:12":1},"rows":{"post:10":{"author":1,"hash":"0000","id":10},"post:11":{"author":1,"hash":"0000","id":11},"post:12":{"author":2,"hash":"0000","id":12}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":2,"user:1":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:10":1,"post:12":1},"last_hash":"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.706090Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"author": Number(2), "hash": String("0000"), "id": Number(13)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.706532Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.706561Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_u_p, delta_len=1, hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78, last_hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.707465Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:12\":1,\"post:13\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:12\":1,\"post:11\":1},\"last_hash\":\"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4630[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:12\":1,\"post:13\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:12\":1,\"post:11\":1},\"last_hash\":\"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4630[0m
[2m2025-12-30T20:27:26.707537Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"post":{"name":"post","zset":{"post:11":1,"post:10":1,"post:12":1,"post:13":1},"rows":{"post:13":{"author":2,"hash":"0000","id":13},"post:11":{"author":1,"hash":"0000","id":11},"post:10":{"author":1,"hash":"0000","id":10},"post:12":{"author":2,"hash":"0000","id":12}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:12":1,"post:11":1},"last_hash":"7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.707955Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"author": Number(1), "hash": String("0000"), "id": Number(5)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.708442Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.708480Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_u_p, delta_len=1, hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78, last_hash=02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78
DEBUG: process: view=view_feed, delta_len=2, hash=7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033, last_hash=7602f7c000b60d48a30bb99bf9e9a7b19279df77d2f7ea9ca5d5caa4058e4cec
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.709463Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:10\":1,\"post:05\":1,\"post:11\":1,\"post:12\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:05\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4686[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:10\":1,\"post:05\":1,\"post:11\":1,\"post:12\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:05\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4686[0m
[2m2025-12-30T20:27:26.709530Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"post":{"name":"post","zset":{"post:13":1,"post:10":1,"post:05":1,"post:11":1,"post:12":1},"rows":{"post:12":{"author":2,"hash":"0000","id":12},"post:10":{"author":1,"hash":"0000","id":10},"post:13":{"author":2,"hash":"0000","id":13},"post:11":{"author":1,"hash":"0000","id":11},"post:05":{"author":1,"hash":"0000","id":5}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":3},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:05":1,"post:11":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.710159Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"2241" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a6dbc969-34eb-4d55-9192-eb6c6bc9ba4a" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m23[0m
[2m2025-12-30T20:27:26.712654Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.712682Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.712698Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.712743Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.712789Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"view_order\", \"SELECT * FROM items ORDER BY val DESC LIMIT 2\", {});\n            LET $r2 = mod::dbsp::register_view(\"view_or\", \"SELECT * FROM items WHERE val = 10 OR val = 100\", {});\n            \n            // Ingest\n            LET $i1 = { id: 1, val: 10, hash: \"0000\" };\n            LET $i2 = { id: 2, val: 20, hash: \"0000\" };\n            LET $i3 = { id: 3, val: 100, hash: \"0000\" };\n            \n            LET $res1 = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:1\", $i1);\n            LET $res2 = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:2\", $i2);\n            LET $res3 = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:3\", $i3);\n            \n            RETURN {\n                up1: $res1.updates,\n                up2: $res2.updates,\n                up3: $res3.updates\n            };\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m845[0m
[2m2025-12-30T20:27:26.712884Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.713699Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.713739Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.714741Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:13\":1,\"post:12\":1,\"post:10\":1,\"post:11\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m4871[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:13\":1,\"post:12\":1,\"post:10\":1,\"post:11\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m4871[0m
[2m2025-12-30T20:27:26.714805Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"post":{"name":"post","zset":{"post:05":1,"post:13":1,"post:12":1,"post:10":1,"post:11":1},"rows":{"post:12":{"author":2,"hash":"0000","id":12},"post:11":{"author":1,"hash":"0000","id":11},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:05":{"author":1,"hash":"0000","id":5}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:2":{"hash":"0001","id":2,"status":"active"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:10":1,"post:05":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.715211Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.715771Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.715813Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.716776Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"post\":{\"name\":\"post\",\"zset\":{\"post:12\":1,\"post:11\":1,\"post:05\":1,\"post:13\":1,\"post:10\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5116[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"post\":{\"name\":\"post\",\"zset\":{\"post:12\":1,\"post:11\":1,\"post:05\":1,\"post:13\":1,\"post:10\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5116[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.716861Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"post":{"name":"post","zset":{"post:12":1,"post:11":1,"post:05":1,"post:13":1,"post:10":1},"rows":{"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:12":{"author":2,"hash":"0000","id":12},"post:05":{"author":1,"hash":"0000","id":5},"post:11":{"author":1,"hash":"0000","id":11}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:2":{"hash":"0001","id":2,"status":"active"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:11":1,"post:05":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{},"last_hash":"","params":{}}]}'
[2m2025-12-30T20:27:26.717419Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(1), "val": Number(10)}
[2m2025-12-30T20:27:26.717848Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.717880Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_order, delta_len=1, hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa, last_hash=
DEBUG: process: view=view_or, delta_len=1, hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.719047Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:1\":1},\"rows\":{\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:13\":1,\"post:05\":1,\"post:12\":1,\"post:10\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5363[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:1\":1},\"rows\":{\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:13\":1,\"post:05\":1,\"post:12\":1,\"post:10\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:11\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5363[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.719120Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"items":{"name":"items","zset":{"items:1":1},"rows":{"items:1":{"hash":"0000","id":1,"val":10}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"post":{"name":"post","zset":{"post:11":1,"post:13":1,"post:05":1,"post:12":1,"post:10":1},"rows":{"post:12":{"author":2,"hash":"0000","id":12},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:11":{"author":1,"hash":"0000","id":11},"post:05":{"author":1,"hash":"0000","id":5}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:11":1,"post:05":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:1":1},"last_hash":"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:1":1},"last_hash":"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa","params":{}}]}'
[2m2025-12-30T20:27:26.719751Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(2), "val": Number(20)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.720183Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.720213Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_order, delta_len=1, hash=652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a, last_hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.721352Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:12\":1,\"post:13\":1,\"post:10\":1,\"post:11\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:11\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":1,\"items:2\":1},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5429[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:12\":1,\"post:13\":1,\"post:10\":1,\"post:11\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:11\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":1,\"items:2\":1},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5429[0m
[2m2025-12-30T20:27:26.721428Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"items":{"name":"items","zset":{"items:2":1,"items:1":1},"rows":{"items:2":{"hash":"0000","id":2,"val":20},"items:1":{"hash":"0000","id":1,"val":10}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"post":{"name":"post","zset":{"post:05":1,"post:12":1,"post:13":1,"post:10":1,"post:11":1},"rows":{"post:11":{"author":1,"hash":"0000","id":11},"post:05":{"author":1,"hash":"0000","id":5},"post:10":{"author":1,"hash":"0000","id":10},"post:13":{"author":2,"hash":"0000","id":13},"post:12":{"author":2,"hash":"0000","id":12}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:05":1,"post:11":1,"post:10":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:1":1,"items:2":1},"last_hash":"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:1":1},"last_hash":"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.721947Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"hash": String("0000"), "id": Number(3), "val": Number(100)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.722407Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.722432Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_order, delta_len=2, hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f, last_hash=652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a
DEBUG: process: view=view_or, delta_len=1, hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd, last_hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.723573Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":1,\"items:3\":1},\"rows\":{\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10},\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:12\":1,\"post:10\":1,\"post:11\":1,\"post:13\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:05\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1,\"items:3\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5496[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":1,\"items:3\":1},\"rows\":{\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10},\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:05\":1,\"post:12\":1,\"post:10\":1,\"post:11\":1,\"post:13\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:10\":1,\"post:05\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1,\"items:3\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5496[0m
[2m2025-12-30T20:27:26.723646Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"items":{"name":"items","zset":{"items:2":1,"items:1":1,"items:3":1},"rows":{"items:1":{"hash":"0000","id":1,"val":10},"items:2":{"hash":"0000","id":2,"val":20},"items:3":{"hash":"0000","id":3,"val":100}}},"post":{"name":"post","zset":{"post:05":1,"post:12":1,"post:10":1,"post:11":1,"post:13":1},"rows":{"post:12":{"author":2,"hash":"0000","id":12},"post:05":{"author":1,"hash":"0000","id":5},"post:11":{"author":1,"hash":"0000","id":11},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:10":1,"post:05":1,"post:11":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:3":1,"items:2":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:1":1,"items:3":1},"last_hash":"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.724383Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"893" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"682d224e-cd8b-403c-a828-14df292b9755" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m11[0m
[2m2025-12-30T20:27:26.727030Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.727056Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.727069Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.727113Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.727159Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n            LET $r1 = mod::dbsp::register_view(\"complex_filter\", \"SELECT * FROM items WHERE (category = 'A' OR category = 'B') AND active = true\", {});\n            LET $r2 = mod::dbsp::register_view(\"multi_order\", \"SELECT * FROM items ORDER BY category ASC, score DESC LIMIT 2\", {});\n            \n            LET $i1 = { category: 'A', score: 10, active: true, hash: \"0000\" };\n            LET $i2 = { category: 'A', score: 20, active: false, hash: \"0000\" };\n            LET $i3 = { category: 'B', score: 10, active: true, hash: \"0000\" };\n            LET $i4 = { category: 'A', score: 30, active: true, hash: \"0000\" };\n            \n            LET $res = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:1\", $i1);\n            LET $res = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:2\", $i2);\n            LET $res = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:3\", $i3);\n            LET $res = mod::dbsp::ingest(\"items\", \"CREATE\", \"items:4\", $i4);\n            \n            RETURN $res.updates;\n        " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m994[0m
[2m2025-12-30T20:27:26.727234Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.727959Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.728006Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.729280Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:12\":1,\"post:05\":1,\"post:10\":1,\"post:13\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:3\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:05\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":1,\"items:3\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1,\"items:3\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5684[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:12\":1,\"post:05\":1,\"post:10\":1,\"post:13\":1},\"rows\":{\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:3\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:05\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":1,\"items:3\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:1\":1,\"items:3\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5684[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.729382Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:2":{"hash":"0001","id":2,"status":"active"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"post":{"name":"post","zset":{"post:11":1,"post:12":1,"post:05":1,"post:10":1,"post:13":1},"rows":{"post:12":{"author":2,"hash":"0000","id":12},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:11":{"author":1,"hash":"0000","id":11},"post:05":{"author":1,"hash":"0000","id":5}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"items":{"name":"items","zset":{"items:2":1,"items:3":1,"items:1":1},"rows":{"items:2":{"hash":"0000","id":2,"val":20},"items:3":{"hash":"0000","id":3,"val":100},"items:1":{"hash":"0000","id":1,"val":10}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":3},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:05":1,"post:10":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:2":1,"items:3":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:1":1,"items:3":1},"last_hash":"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{},"last_hash":"","params":{}}]}'
[2m2025-12-30T20:27:26.730228Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.730865Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.730906Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.732044Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:12\":1,\"post:11\":1,\"post:05\":1,\"post:10\":1},\"rows\":{\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":1,\"items:2\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1,\"items:1\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m5911[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:12\":1,\"post:11\":1,\"post:05\":1,\"post:10\":1},\"rows\":{\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":1,\"items:2\":1,\"items:1\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"hash\":\"0000\",\"id\":1,\"val\":10}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1,\"items:1\":1},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m5911[0m
[2m2025-12-30T20:27:26.732123Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"post":{"name":"post","zset":{"post:13":1,"post:12":1,"post:11":1,"post:05":1,"post:10":1},"rows":{"post:05":{"author":1,"hash":"0000","id":5},"post:12":{"author":2,"hash":"0000","id":12},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:11":{"author":1,"hash":"0000","id":11}}},"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:2":{"hash":"0001","id":2,"status":"active"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"items":{"name":"items","zset":{"items:3":1,"items:2":1,"items:1":1},"rows":{"items:2":{"hash":"0000","id":2,"val":20},"items:3":{"hash":"0000","id":3,"val":100},"items:1":{"hash":"0000","id":1,"val":10}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":3},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:10":1,"post:05":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:3":1,"items:2":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:3":1,"items:1":1},"last_hash":"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"multi_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"category","direction":"ASC"},{"field":"score","direction":"DESC"}]}},"cache":{},"last_hash":"","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.732560Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(true), "category": String("A"), "hash": String("0000"), "score": Number(10)}
[2m2025-12-30T20:27:26.733049Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.733071Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_or, delta_len=1, hash=4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d, last_hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd
DEBUG: process: view=complex_filter, delta_len=1, hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa, last_hash=
DEBUG: process: view=multi_order, delta_len=2, hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f, last_hash=
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.734383Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":2,\"items:3\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:12\":1,\"post:13\":1,\"post:05\":1,\"post:11\":1,\"post:10\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:11\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1},\"last_hash\":\"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m6085[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"items\":{\"name\":\"items\",\"zset\":{\"items:2\":1,\"items:1\":2,\"items:3\":1},\"rows\":{\"items:2\":{\"hash\":\"0000\",\"id\":2,\"val\":20},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"},\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:12\":1,\"post:13\":1,\"post:05\":1,\"post:11\":1,\"post:10\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:11\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1},\"last_hash\":\"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:2\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m6085[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.734456Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"items":{"name":"items","zset":{"items:2":1,"items:1":2,"items:3":1},"rows":{"items:2":{"hash":"0000","id":2,"val":20},"items:3":{"hash":"0000","id":3,"val":100},"items:1":{"active":true,"category":"A","hash":"0000","score":10}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:2":{"hash":"0001","id":2,"status":"active"},"user:1":{"hash":"0000","id":1,"status":"active"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"post":{"name":"post","zset":{"post:12":1,"post:13":1,"post:05":1,"post:11":1,"post:10":1},"rows":{"post:13":{"author":2,"hash":"0000","id":13},"post:05":{"author":1,"hash":"0000","id":5},"post:10":{"author":1,"hash":"0000","id":10},"post:12":{"author":2,"hash":"0000","id":12},"post:11":{"author":1,"hash":"0000","id":11}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":3},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:05":1,"post:11":1,"post:10":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:3":1,"items:2":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:3":1},"last_hash":"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{"items:1":2},"last_hash":"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa","params":{}},{"plan":{"id":"multi_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"category","direction":"ASC"},{"field":"score","direction":"DESC"}]}},"cache":{"items:3":1,"items:2":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}}]}'
[2m2025-12-30T20:27:26.735271Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(false), "category": String("A"), "hash": String("0000"), "score": Number(20)}
[2m2025-12-30T20:27:26.735784Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.735810Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=view_order, delta_len=2, hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd, last_hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f
DEBUG: process: view=multi_order, delta_len=1, hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f, last_hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.737067Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:1\":2,\"items:3\":1,\"items:2\":2},\"rows\":{\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:13\":1,\"post:12\":1,\"post:05\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:1\":2},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1},\"last_hash\":\"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:3\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m6110[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:2\":2,\"user:1\":1},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:1\":2,\"items:3\":1,\"items:2\":2},\"rows\":{\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10},\"items:3\":{\"hash\":\"0000\",\"id\":3,\"val\":100},\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:11\":1,\"post:10\":1,\"post:13\":1,\"post:12\":1,\"post:05\":1},\"rows\":{\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:10\":1,\"post:05\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:3\":1,\"items:1\":2},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{\"items:3\":1},\"last_hash\":\"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2},\"last_hash\":\"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:3\":1},\"last_hash\":\"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m6110[0m
[2m2025-12-30T20:27:26.737156Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"user":{"name":"user","zset":{"user:2":2,"user:1":1},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"items":{"name":"items","zset":{"items:1":2,"items:3":1,"items:2":2},"rows":{"items:1":{"active":true,"category":"A","hash":"0000","score":10},"items:3":{"hash":"0000","id":3,"val":100},"items:2":{"active":false,"category":"A","hash":"0000","score":20}}},"post":{"name":"post","zset":{"post:11":1,"post:10":1,"post:13":1,"post:12":1,"post:05":1},"rows":{"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:05":{"author":1,"hash":"0000","id":5},"post:12":{"author":2,"hash":"0000","id":12},"post:11":{"author":1,"hash":"0000","id":11}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:10":1,"post:05":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:3":1,"items:1":2},"last_hash":"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{"items:3":1},"last_hash":"4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{"items:1":2},"last_hash":"e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa","params":{}},{"plan":{"id":"multi_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"category","direction":"ASC"},{"field":"score","direction":"DESC"}]}},"cache":{"items:2":2,"items:3":1},"last_hash":"fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.737717Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(true), "category": String("B"), "hash": String("0000"), "score": Number(10)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.738144Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.738164Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: process: view=view_order, delta_len=2, hash=652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a, last_hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd
DEBUG: process: view=view_or, delta_len=1, hash=af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262, last_hash=4e022b97cd3b369980f9eeafe7f5511d7675b6a448ed2fd4a63b88efa823f67d
DEBUG: process: view=complex_filter, delta_len=1, hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd, last_hash=e457bb0ed7c25faaccd170ed0020015f36235d20296b3ef28dff4fb86b7906fa
DEBUG: process: view=multi_order, delta_len=2, hash=652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a, last_hash=fed02d9ede734134a57d9413fac0186501af0dcaf834a7b6b9b878b512ae6a4f
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.739561Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":2,\"items:1\":2,\"items:2\":2},\"rows\":{\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20},\"items:3\":{\"active\":true,\"category\":\"B\",\"hash\":\"0000\",\"score\":10},\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:10\":1,\"post:12\":1,\"post:05\":1,\"post:11\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:10\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":2,\"items:2\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2,\"items:3\":2},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:1\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m6134[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:active:99\":1,\"users:1\":1},\"rows\":{\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"},\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":2,\"items:1\":2,\"items:2\":2},\"rows\":{\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20},\"items:3\":{\"active\":true,\"category\":\"B\",\"hash\":\"0000\",\"score\":10},\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10}}},\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:20\":1,\"users_limit:10\":1},\"rows\":{\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"},\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:10\":1,\"post:12\":1,\"post:05\":1,\"post:11\":1},\"rows\":{\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12},\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:1\":3,\"user:2\":4},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:05\":1,\"post:10\":1,\"post:11\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:1\":2,\"items:2\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:1\":2,\"items:3\":2},\"last_hash\":\"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:1\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m6134[0m
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.739642Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"users":{"name":"users","zset":{"users:active:99":1,"users:1":1},"rows":{"users:active:99":{"active":true,"hash":"0000","name":"Bob"},"users:1":{"hash":"0000","id":1,"name":"Alice"}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"items":{"name":"items","zset":{"items:3":2,"items:1":2,"items:2":2},"rows":{"items:2":{"active":false,"category":"A","hash":"0000","score":20},"items:3":{"active":true,"category":"B","hash":"0000","score":10},"items:1":{"active":true,"category":"A","hash":"0000","score":10}}},"users_limit":{"name":"users_limit","zset":{"users_limit:20":1,"users_limit:10":1},"rows":{"users_limit:10":{"hash":"0001","id":10,"name":"B"},"users_limit:20":{"hash":"0000","id":20,"name":"A"}}},"post":{"name":"post","zset":{"post:13":1,"post:10":1,"post:12":1,"post:05":1,"post:11":1},"rows":{"post:10":{"author":1,"hash":"0000","id":10},"post:13":{"author":2,"hash":"0000","id":13},"post:05":{"author":1,"hash":"0000","id":5},"post:12":{"author":2,"hash":"0000","id":12},"post:11":{"author":1,"hash":"0000","id":11}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:1":3,"user:2":4},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:05":1,"post:10":1,"post:11":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:1":2,"items:2":2},"last_hash":"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{},"last_hash":"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{"items:1":2,"items:3":2},"last_hash":"be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd","params":{}},{"plan":{"id":"multi_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"category","direction":"ASC"},{"field":"score","direction":"DESC"}]}},"cache":{"items:2":2,"items:1":2},"last_hash":"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a","params":{}}]}'
[2m2025-12-30T20:27:26.740649Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: normalize_record received direct record: Object {"active": Bool(true), "category": String("A"), "hash": String("0000"), "score": Number(30)}
DEBUG: load_state: Loading from DB...
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.741211Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-30T20:27:26.741255Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
üü¢ Async body completed for: __sr_sql
DEBUG: process: view=complex_filter, delta_len=1, hash=8ea66da9a6dbcfebdbc0d304e1efb5417f354b0d999d0cd585edb810bef154bc, last_hash=be5dcce8af6592be2f16c016da6bf2bab119b60b66dcf0d23b4acda2f0b4f6cd
DEBUG: process: view=multi_order, delta_len=2, hash=7cce54002ea011de82dcefadb6b955259ecf09447846010c5af9fda3c58e4b91, last_hash=652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a
üîµ Host function called: __sr_sql
üü° Executing async body for: __sr_sql
[2m2025-12-30T20:27:26.742633Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:05\":1,\"post:11\":1,\"post:12\":1,\"post:10\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":2,\"items:2\":2,\"items:1\":2,\"items:4\":1},\"rows\":{\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10},\"items:4\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":30},\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20},\"items:3\":{\"active\":true,\"category\":\"B\",\"hash\":\"0000\",\"score\":10}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:05\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:1\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:4\":1,\"items:1\":2,\"items:3\":2},\"last_hash\":\"8ea66da9a6dbcfebdbc0d304e1efb5417f354b0d999d0cd585edb810bef154bc\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:4\":1,\"items:2\":2},\"last_hash\":\"7cce54002ea011de82dcefadb6b955259ecf09447846010c5af9fda3c58e4b91\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m6224[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"users_limit\":{\"name\":\"users_limit\",\"zset\":{\"users_limit:10\":1,\"users_limit:20\":1},\"rows\":{\"users_limit:20\":{\"hash\":\"0000\",\"id\":20,\"name\":\"A\"},\"users_limit:10\":{\"hash\":\"0001\",\"id\":10,\"name\":\"B\"}}},\"users\":{\"name\":\"users\",\"zset\":{\"users:1\":1,\"users:active:99\":1},\"rows\":{\"users:1\":{\"hash\":\"0000\",\"id\":1,\"name\":\"Alice\"},\"users:active:99\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Bob\"}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:1\":1,\"user:2\":2},\"rows\":{\"user:1\":{\"hash\":\"0000\",\"id\":1,\"status\":\"active\"},\"user:2\":{\"hash\":\"0001\",\"id\":2,\"status\":\"active\"}}},\"post\":{\"name\":\"post\",\"zset\":{\"post:13\":1,\"post:05\":1,\"post:11\":1,\"post:12\":1,\"post:10\":1},\"rows\":{\"post:11\":{\"author\":1,\"hash\":\"0000\",\"id\":11},\"post:13\":{\"author\":2,\"hash\":\"0000\",\"id\":13},\"post:10\":{\"author\":1,\"hash\":\"0000\",\"id\":10},\"post:05\":{\"author\":1,\"hash\":\"0000\",\"id\":5},\"post:12\":{\"author\":2,\"hash\":\"0000\",\"id\":12}}},\"items\":{\"name\":\"items\",\"zset\":{\"items:3\":2,\"items:2\":2,\"items:1\":2,\"items:4\":1},\"rows\":{\"items:1\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":10},\"items:4\":{\"active\":true,\"category\":\"A\",\"hash\":\"0000\",\"score\":30},\"items:2\":{\"active\":false,\"category\":\"A\",\"hash\":\"0000\",\"score\":20},\"items:3\":{\"active\":true,\"category\":\"B\",\"hash\":\"0000\",\"score\":10}}},\"threads\":{\"name\":\"threads\",\"zset\":{\"threads:2024:1\":1},\"rows\":{\"threads:2024:1\":{\"hash\":\"0000\",\"title\":\"Hello\"}}},\"users_incr\":{\"name\":\"users_incr\",\"zset\":{\"users_incr:active:1\":1},\"rows\":{\"users_incr:active:1\":{\"active\":true,\"hash\":\"0000\",\"name\":\"Alice\"}}},\"posts\":{\"name\":\"posts\",\"zset\":{\"posts:10\":1},\"rows\":{\"posts:10\":{\"author\":1,\"hash\":\"0001\",\"id\":10,\"title\":\"Hello\"}}},\"tree_items\":{\"name\":\"tree_items\",\"zset\":{\"item:2\":1},\"rows\":{\"item:2\":{\"hash\":\"0001\",\"id\":\"item:2\",\"val\":\"B\"}}}}},\"views\":[{\"plan\":{\"id\":\"view_users_incr\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users_incr\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":\"users_incr:active:1\"}}},\"cache\":{\"users_incr:active:1\":1},\"last_hash\":\"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f\",\"params\":{}},{\"plan\":{\"id\":\"view_users_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"users\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{\"users:active:99\":1},\"last_hash\":\"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915\",\"params\":{}},{\"plan\":{\"id\":\"view_threads_recent\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"threads\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"threads:2024\"}}},\"cache\":{\"threads:2024:1\":1},\"last_hash\":\"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8\",\"params\":{}},{\"plan\":{\"id\":\"view_users_threads_join\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"threads\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"users:active\"}}},\"cache\":{},\"last_hash\":\"\",\"params\":{}},{\"plan\":{\"id\":\"view_tree_test\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"tree_items\"},\"predicate\":{\"type\":\"prefix\",\"prefix\":\"item\"}}},\"cache\":{\"item:2\":1},\"last_hash\":\"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6\",\"params\":{}},{\"plan\":{\"id\":\"view_join_sql\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"users\"},\"right\":{\"op\":\"scan\",\"table\":\"posts\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"users:1\":1},\"last_hash\":\"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858\",\"params\":{}},{\"plan\":{\"id\":\"view_limit_eviction\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"users_limit\"},\"limit\":1,\"order_by\":null}},\"cache\":{\"users_limit:10\":1},\"last_hash\":\"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775\",\"params\":{}},{\"plan\":{\"id\":\"view_nested_limit\",\"root\":{\"op\":\"project\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"projections\":[{\"type\":\"all\"},{\"type\":\"subquery\",\"alias\":\"subquery\",\"plan\":{\"op\":\"limit\",\"input\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"predicate\":{\"type\":\"eq\",\"field\":\"author\",\"value\":{\"$param\":\"id\"}}},\"limit\":2,\"order_by\":null}}]}},\"cache\":{\"user:1\":1,\"user:2\":2},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_active\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"status\",\"value\":\"active\"}}},\"cache\":{\"user:2\":2,\"user:1\":1},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_u_p\",\"root\":{\"op\":\"join\",\"left\":{\"op\":\"scan\",\"table\":\"user\"},\"right\":{\"op\":\"scan\",\"table\":\"post\"},\"on\":{\"left_field\":\"id\",\"right_field\":\"author\"}}},\"cache\":{\"user:2\":4,\"user:1\":3},\"last_hash\":\"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78\",\"params\":{}},{\"plan\":{\"id\":\"view_feed\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"post\"},\"limit\":3,\"order_by\":null}},\"cache\":{\"post:11\":1,\"post:05\":1,\"post:10\":1},\"last_hash\":\"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033\",\"params\":{}},{\"plan\":{\"id\":\"view_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"val\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:2\":2,\"items:1\":2},\"last_hash\":\"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a\",\"params\":{}},{\"plan\":{\"id\":\"view_or\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"or\",\"predicates\":[{\"type\":\"eq\",\"field\":\"val\",\"value\":10},{\"type\":\"eq\",\"field\":\"val\",\"value\":100}]}}},\"cache\":{},\"last_hash\":\"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262\",\"params\":{}},{\"plan\":{\"id\":\"complex_filter\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"predicate\":{\"type\":\"eq\",\"field\":\"active\",\"value\":true}}},\"cache\":{\"items:4\":1,\"items:1\":2,\"items:3\":2},\"last_hash\":\"8ea66da9a6dbcfebdbc0d304e1efb5417f354b0d999d0cd585edb810bef154bc\",\"params\":{}},{\"plan\":{\"id\":\"multi_order\",\"root\":{\"op\":\"limit\",\"input\":{\"op\":\"scan\",\"table\":\"items\"},\"limit\":2,\"order_by\":[{\"field\":\"category\",\"direction\":\"ASC\"},{\"field\":\"score\",\"direction\":\"DESC\"}]}},\"cache\":{\"items:4\":1,\"items:2\":2},\"last_hash\":\"7cce54002ea011de82dcefadb6b955259ecf09447846010c5af9fda3c58e4b91\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m6224[0m
[2m2025-12-30T20:27:26.742724Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"users_limit":{"name":"users_limit","zset":{"users_limit:10":1,"users_limit:20":1},"rows":{"users_limit:20":{"hash":"0000","id":20,"name":"A"},"users_limit:10":{"hash":"0001","id":10,"name":"B"}}},"users":{"name":"users","zset":{"users:1":1,"users:active:99":1},"rows":{"users:1":{"hash":"0000","id":1,"name":"Alice"},"users:active:99":{"active":true,"hash":"0000","name":"Bob"}}},"user":{"name":"user","zset":{"user:1":1,"user:2":2},"rows":{"user:1":{"hash":"0000","id":1,"status":"active"},"user:2":{"hash":"0001","id":2,"status":"active"}}},"post":{"name":"post","zset":{"post:13":1,"post:05":1,"post:11":1,"post:12":1,"post:10":1},"rows":{"post:11":{"author":1,"hash":"0000","id":11},"post:13":{"author":2,"hash":"0000","id":13},"post:10":{"author":1,"hash":"0000","id":10},"post:05":{"author":1,"hash":"0000","id":5},"post:12":{"author":2,"hash":"0000","id":12}}},"items":{"name":"items","zset":{"items:3":2,"items:2":2,"items:1":2,"items:4":1},"rows":{"items:1":{"active":true,"category":"A","hash":"0000","score":10},"items:4":{"active":true,"category":"A","hash":"0000","score":30},"items:2":{"active":false,"category":"A","hash":"0000","score":20},"items:3":{"active":true,"category":"B","hash":"0000","score":10}}},"threads":{"name":"threads","zset":{"threads:2024:1":1},"rows":{"threads:2024:1":{"hash":"0000","title":"Hello"}}},"users_incr":{"name":"users_incr","zset":{"users_incr:active:1":1},"rows":{"users_incr:active:1":{"active":true,"hash":"0000","name":"Alice"}}},"posts":{"name":"posts","zset":{"posts:10":1},"rows":{"posts:10":{"author":1,"hash":"0001","id":10,"title":"Hello"}}},"tree_items":{"name":"tree_items","zset":{"item:2":1},"rows":{"item:2":{"hash":"0001","id":"item:2","val":"B"}}}}},"views":[{"plan":{"id":"view_users_incr","root":{"op":"filter","input":{"op":"scan","table":"users_incr"},"predicate":{"type":"eq","field":"id","value":"users_incr:active:1"}}},"cache":{"users_incr:active:1":1},"last_hash":"2b6c863c084ac0d24d95e7fffd27ec6352596944ab74529e997faf665286798f","params":{}},{"plan":{"id":"view_users_active","root":{"op":"filter","input":{"op":"scan","table":"users"},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{"users:active:99":1},"last_hash":"38bb61d3f5529b9c5bd4291d4320f067279f8e542d44ea0bf781e01af5dff915","params":{}},{"plan":{"id":"view_threads_recent","root":{"op":"filter","input":{"op":"scan","table":"threads"},"predicate":{"type":"prefix","prefix":"threads:2024"}}},"cache":{"threads:2024:1":1},"last_hash":"3f148fd17e41edd62e84b323725230beabcdbb89acf0dbf4d1c223dc4fc414e8","params":{}},{"plan":{"id":"view_users_threads_join","root":{"op":"filter","input":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"threads"},"on":{"left_field":"id","right_field":"author"}},"predicate":{"type":"prefix","prefix":"users:active"}}},"cache":{},"last_hash":"","params":{}},{"plan":{"id":"view_tree_test","root":{"op":"filter","input":{"op":"scan","table":"tree_items"},"predicate":{"type":"prefix","prefix":"item"}}},"cache":{"item:2":1},"last_hash":"7ddad85f208ef96ffa15306947f68dccfb9f74d51991cd3d7de5ae528f4b2cd6","params":{}},{"plan":{"id":"view_join_sql","root":{"op":"join","left":{"op":"scan","table":"users"},"right":{"op":"scan","table":"posts"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"users:1":1},"last_hash":"eddfdf753d62b56eb28867717b9bc765ca465f2e096a4e5bdba992610aae9858","params":{}},{"plan":{"id":"view_limit_eviction","root":{"op":"limit","input":{"op":"scan","table":"users_limit"},"limit":1,"order_by":null}},"cache":{"users_limit:10":1},"last_hash":"3ed259e81f4bf5e7ce2fe071f15f4b188c849ec9318a46d0dc2a0eeb4b582775","params":{}},{"plan":{"id":"view_nested_limit","root":{"op":"project","input":{"op":"scan","table":"user"},"projections":[{"type":"all"},{"type":"subquery","alias":"subquery","plan":{"op":"limit","input":{"op":"filter","input":{"op":"scan","table":"post"},"predicate":{"type":"eq","field":"author","value":{"$param":"id"}}},"limit":2,"order_by":null}}]}},"cache":{"user:1":1,"user:2":2},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_active","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"status","value":"active"}}},"cache":{"user:2":2,"user:1":1},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_u_p","root":{"op":"join","left":{"op":"scan","table":"user"},"right":{"op":"scan","table":"post"},"on":{"left_field":"id","right_field":"author"}}},"cache":{"user:2":4,"user:1":3},"last_hash":"02110b0857d9a73f9d5ac453463a7bc5d80cbc4ceda862a83b27039c16091a78","params":{}},{"plan":{"id":"view_feed","root":{"op":"limit","input":{"op":"scan","table":"post"},"limit":3,"order_by":null}},"cache":{"post:11":1,"post:05":1,"post:10":1},"last_hash":"7859d3f969dbd0d4d18e60d2f94b8fbb8c027f5d3a12e854331e6da0b852d033","params":{}},{"plan":{"id":"view_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"val","direction":"DESC"}]}},"cache":{"items:2":2,"items:1":2},"last_hash":"652baaf43a432f6aca3d035ecb26d140fc027b2bc6bd412f9bca52a345ccda1a","params":{}},{"plan":{"id":"view_or","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"or","predicates":[{"type":"eq","field":"val","value":10},{"type":"eq","field":"val","value":100}]}}},"cache":{},"last_hash":"af1349b9f5f9a1a6a0404dea36dcc9499bcb25c9adc112b7cc9a93cae41f3262","params":{}},{"plan":{"id":"complex_filter","root":{"op":"filter","input":{"op":"scan","table":"items"},"predicate":{"type":"eq","field":"active","value":true}}},"cache":{"items:4":1,"items:1":2,"items:3":2},"last_hash":"8ea66da9a6dbcfebdbc0d304e1efb5417f354b0d999d0cd585edb810bef154bc","params":{}},{"plan":{"id":"multi_order","root":{"op":"limit","input":{"op":"scan","table":"items"},"limit":2,"order_by":[{"field":"category","direction":"ASC"},{"field":"score","direction":"DESC"}]}},"cache":{"items:4":1,"items:2":2},"last_hash":"7cce54002ea011de82dcefadb6b955259ecf09447846010c5af9fda3c58e4b91","params":{}}]}'
üü¢ Async body completed for: __sr_sql
[2m2025-12-30T20:27:26.743584Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"1042" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"d06b0d0e-f5f8-4c76-9756-dc9aad6e3161" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m16[0m
[2m2025-12-30T20:27:26.745968Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"46b2d460-7540-47d1-8d7b-c459855ec21a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.745993Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"46b2d460-7540-47d1-8d7b-c459855ec21a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.746008Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"46b2d460-7540-47d1-8d7b-c459855ec21a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.746044Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"46b2d460-7540-47d1-8d7b-c459855ec21a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-30T20:27:26.746106Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing SurrealQL query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"46b2d460-7540-47d1-8d7b-c459855ec21a" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"REMOVE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
PASS surrealdb/dbsp.test.ts
  DBSP Module Integration
    ‚úì should register a view and ingest data with incremental updates (9 ms)
    ‚úì should support multiple concurrent views (9 ms)
    ‚úì should register a complex join plan (SQL) (5 ms)
    ‚úì should update id tree on data change (10 ms)
    ‚úì should support complex recursive join with subquery via SQL (8 ms)
    ‚úì should handle limit eviction (8 ms)
    ‚úì should handle nested limit via subquery projection (SQL) (3 ms)
    ‚úì Full Scenario: Social Network End-to-End (25 ms)
    ‚úì should handle ORDER BY and OR logic (14 ms)
    ‚úì should handle complex AND/OR and multi-field ORDER BY (19 ms)

Test Suites: 1 passed, 1 total
Tests:       10 passed, 10 total
Snapshots:   0 total
Time:        4.945 s, estimated 5 s
Ran all test suites matching /surrealdb\/dbsp.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
