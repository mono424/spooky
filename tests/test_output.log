  console.log
    Starting SurrealDB container...

      at getContainer (surrealdb/setup.ts:17:11)


 .d8888b.                                             888 8888888b.  888888b.
d88P  Y88b                                            888 888  'Y88b 888  '88b
Y88b.                                                 888 888    888 888  .88P
 'Y888b.   888  888 888d888 888d888  .d88b.   8888b.  888 888    888 8888888K.
    'Y88b. 888  888 888P'   888P'   d8P  Y8b     '88b 888 888    888 888  'Y88b
      '888 888  888 888     888     88888888 .d888888 888 888    888 888    888
Y88b  d88P Y88b 888 888     888     Y8b.     888  888 888 888  .d88P 888   d88P
 'Y8888P'   'Y88888 888     888      'Y8888  'Y888888 888 8888888P'  8888888P'


[2m2025-12-28T18:30:48.971261Z[0m [32m INFO[0m [2msurrealdb_server::env[0m[2m:[0m Running 3.0.0-alpha.17 for linux on aarch64
[2m2025-12-28T18:30:49.033426Z[0m [34mDEBUG[0m [1minit[0m: [2msurrealdb_server::dbs[0m[2m:[0m Server capabilities: scripting=true, guest_access=true, live_query_notifications=true, allow_funcs=all, deny_funcs=none, allow_net=all, deny_net=none, allow_rpc=all, deny_rpc=none, allow_http=all, deny_http=none, allow_experimental=all, deny_experimental=none, allow_arbitrary_query=all, deny_arbitrary_query=none
[2m2025-12-28T18:30:49.033465Z[0m [32m INFO[0m [1minit[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Starting kvs store in memory
[2m2025-12-28T18:30:49.035664Z[0m [32m INFO[0m [1minit[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Started kvs store in memory
[2m2025-12-28T18:30:49.049727Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"check_version" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.049738Z[0m [32m INFO[0m [1minit[0m:[1minitialise_defaults[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m This is a new SurrealDB instance. Initialising default namespace 'main' and database 'main'
[2m2025-12-28T18:30:49.049759Z[0m [35mTRACE[0m [1minit[0m:[1minitialise_defaults[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3minput[0m[2m=[0m"\n\t\t\tDEFINE NAMESPACE $namespace COMMENT 'Default namespace generated by SurrealDB'; \n\t\t\tUSE NS $namespace;\n\t\t\tDEFINE DATABASE $database COMMENT 'Default database generated by SurrealDB'; \n\t\t\tDEFINE CONFIG DEFAULT NAMESPACE $namespace DATABASE $database;\n\t\t" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m256[0m
[2m2025-12-28T18:30:49.050389Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"initialise_defaults" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.050406Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Initialising credentials [3muser[0m[2m=[0mroot
[2m2025-12-28T18:30:49.050433Z[0m [32m INFO[0m [1minit[0m:[1minitialise_credentials[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Credentials were provided, and no root users were found. The root user 'root' will be created
[2m2025-12-28T18:30:49.065542Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"initialise_credentials" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.065558Z[0m [35mTRACE[0m [1minit[0m:[1minsert_node[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Inserting node in the cluster [3mid[0m[2m=[0m736c815e-7d3e-4ef9-b3ea-a73b425bed9c
  console.log
    SurrealDB started on port 56211

      at getContainer (surrealdb/setup.ts:62:11)

[2m2025-12-28T18:30:49.097589Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Insert node" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.097608Z[0m [35mTRACE[0m [1minit[0m:[1mexpire_nodes[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Archiving expired nodes in the cluster
[2m2025-12-28T18:30:49.097665Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Expire nodes" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.097673Z[0m [35mTRACE[0m [1minit[0m:[1mremove_nodes[0m: [2msurrealdb::core::kvs::ds[0m[2m:[0m Cleaning up archived nodes in the cluster
[2m2025-12-28T18:30:49.097698Z[0m [32m INFO[0m [1minit[0m: [2msurreal::dbs[0m[2m:[0m Operation succeeded [3moperation[0m[2m=[0m"Remove nodes" [3mattempts[0m[2m=[0m1
[2m2025-12-28T18:30:49.097783Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Updating node registration information every 3s
[2m2025-12-28T18:30:49.097841Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Processing and cleaning archived nodes every 300s
[2m2025-12-28T18:30:49.097856Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Running changefeed garbage collection every 30s
[2m2025-12-28T18:30:49.097850Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Processing and archiving inactive nodes every 15s
[2m2025-12-28T18:30:49.097864Z[0m [35mTRACE[0m [2msurrealdb::engine::tasks[0m[2m:[0m Running index compaction every 5s
[2m2025-12-28T18:30:49.098047Z[0m [33m WARN[0m [2msurrealdb_server::ntw[0m[2m:[0m âŒðŸ”’IMPORTANT: GraphQL is a pre-release feature with known security flaws. This is not recommended for production use.ðŸ”’âŒ
[2m2025-12-28T18:30:49.098161Z[0m [32m INFO[0m [2msurrealdb::net[0m[2m:[0m Started web server on 0.0.0.0:8000
[2m2025-12-28T18:30:49.098180Z[0m [32m INFO[0m [2msurrealdb::net[0m[2m:[0m Listening for a system shutdown signal.
[2m2025-12-28T18:30:49.120729Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a3bf6bbe-68a0-44c1-b13a-e1f7d65e7032" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.121271Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"a3bf6bbe-68a0-44c1-b13a-e1f7d65e7032" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:49.133035Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"147db6d4-5e84-450e-b644-6584802b69c3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.150316Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::signin[0m[2m:[0m Signing in as root [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"147db6d4-5e84-450e-b644-6584802b69c3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.150402Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"59" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"147db6d4-5e84-450e-b644-6584802b69c3" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m17[0m
[2m2025-12-28T18:30:49.153892Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.153950Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.154045Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.154149Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.154214Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"REMOVE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
[2m2025-12-28T18:30:49.154485Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"47e3a100-3c2a-4e47-a32d-65d789926fc2" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:49.157171Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.157181Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.157189Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.157206Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.157227Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"DEFINE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
  console.log
    Loading generated schema from: /Users/khadim/dev/spooky/tests/.spooky/schema.gen.surql

      at createTestDb (surrealdb/setup.ts:100:13)

[2m2025-12-28T18:30:49.158010Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"70" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"fec75559-f831-4222-81ea-21dc918d2c47" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:49.162168Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.162190Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.162203Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.162237Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.162361Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n-- ==================================================\n-- SURREALISM MODULES\n-- ==================================================\n\n-- Define bucket for module files\nDEFINE BUCKET IF NOT EXISTS modules BACKEND \"file:///modules\";\n\n-- Define the XOR module\nDEFINE MODULE mod::xor AS f\"modules:/xor_module.surli\";\n\n-- Define the DBSP module\nDEFINE MODULE mod::dbsp AS f\"modules:/dbsp_module.surli\";\n\n-- ##################################################################\n-- SCOPES & AUTHENTICATION\n-- ##################################################################\nDEFINE ACCESS account ON DATABASE TYPE RECORD\nSIGNUP ( CREATE ONLY user CONTENT {\n    username: $username,\n    password: crypto::argon2::generate($password),\n    created_at: time::now()\n} )\nSIGNIN ( SELECT * FROM user WHERE username = $username AND crypto::argon2::compare(password, $password) )\nDURATION FOR TOKEN 365d, FOR SESSION 365d;\n\n-- ##################################################################\n-- USER TABLE\n-- ##################################################################\n\nDEFINE TABLE user SCHEMAFULL\nPERMISSIONS\n  FOR update, delete WHERE $access = \"account\" AND id = $auth.id\n  FOR create, select WHERE true;\n\nDEFINE FIELD username ON TABLE user TYPE string\nASSERT $value != NONE AND string::len($value) > 3\nPERMISSIONS\n    FOR select WHERE true\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n    \nDEFINE INDEX unique_username ON TABLE user FIELDS username UNIQUE;\n\nDEFINE FIELD password ON TABLE user TYPE string\nASSERT $value != NONE AND string::len($value) > 0\nPERMISSIONS\n    FOR select WHERE false\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n\nDEFINE FIELD created_at ON TABLE user TYPE datetime\nVALUE time::now()\nPERMISSIONS\n    FOR select WHERE false\n    FOR create WHERE true\n    FOR update WHERE $access = \"account\" AND id = $auth.id;\n\n-- ##################################################################\n-- THREAD TABLE\n-- ##################################################################\n\nDEFINE TABLE thread SCHEMAFULL\n  PERMISSIONS\n    FOR select WHERE true\n    FOR update, delete, create WHERE $access = \"account\" AND author.id = $auth.id\n;\n\n\nDEFINE FIELD title ON TABLE thread TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0 AND string::len($value) <= 200;\n\nDEFINE FIELD content ON TABLE thread TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0;\n\nDEFINE FIELD author ON TABLE thread TYPE record<user>;\n\nDEFINE FIELD created_at ON TABLE thread TYPE datetime\n    VALUE time::now();\n\n-- ##################################################################\n-- COMMENT TABLE\n-- ##################################################################\n\nDEFINE TABLE comment SCHEMAFULL\n  PERMISSIONS\n    FOR select WHERE true\n    FOR update, delete, create WHERE $access = \"account\" AND author.id = $auth.id\n;\n\nDEFINE FIELD thread ON TABLE comment TYPE record<thread>; -- @parent\n\nDEFINE FIELD content ON TABLE comment TYPE string\n    ASSERT $value != NONE AND string::len($value) > 0;\n\nDEFINE FIELD author ON TABLE comment TYPE record<user>;\n\nDEFINE FIELD created_at ON TABLE comment TYPE datetime\n    VALUE time::now();\n\n-- ##################################################################\n-- RELATION TABLES\n-- ##################################################################\n\nDEFINE TABLE commented_on SCHEMAFULL TYPE RELATION\n  FROM comment TO thread\n  PERMISSIONS FOR select WHERE true;\n\nDEFINE EVENT comment_created ON TABLE comment WHEN $event = \"CREATE\" THEN\n  RELATE ($after.id)->commented_on->($after.thread)\n;\n-- ==================================================\n-- SPOOKY INCANTATION\n-- The Registry of active Live Queries (Incantations).\n-- ==================================================\n\nDEFINE TABLE _spooky_query SCHEMALESS\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- The unique hash ID of the query + params\nDEFINE FIELD Id ON TABLE _spooky_query TYPE string\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- The raw query string (for re-hydration/debugging)\nDEFINE FIELD sql ON TABLE _spooky_query TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- The raw query string (for re-hydration/debugging)\nDEFINE FIELD ClientId ON TABLE _spooky_query TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- The current XOR sum of all results in this query\nDEFINE FIELD Hash ON TABLE _spooky_query TYPE option<string>\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- The Radix Tree of Result IDs for efficient sync\nDEFINE FIELD Tree ON TABLE _spooky_query TYPE any\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- For garbage collection (Heartbeat)\nDEFINE FIELD LastActiveAt ON TABLE _spooky_query TYPE datetime DEFAULT time::now()\n    PERMISSIONS FOR select, create, update WHERE true;\n\n-- How long this Incantation stays alive without activity\nDEFINE FIELD TTL ON TABLE _spooky_query TYPE duration\n    PERMISSIONS FOR select, create, update WHERE true;\n\n\n-- Remote-only meta tables (not synced to client)\nDEFINE TABLE _spooky_module_state SCHEMALESS PERMISSIONS FULL;\n\n-- Unregister from DBSP on deletion\nDEFINE EVENT _spooky_dbsp_cleanup ON TABLE _spooky_query WHEN $event = \"DELETE\" THEN {\n    let $result = mod::dbsp::unregister_query($before.Id);\n};\n\n-- Register with DBSP on creation or update\nDEFINE EVENT _spooky_dbsp_register ON TABLE _spooky_query WHEN $event = \"CREATE\" OR ($event = \"UPDATE\" AND ($after.sql != $before.sql OR $after.Params != $before.Params)) THEN {\n    LET $res = mod::dbsp::register_view($after.Id, $after.sql, <string>($after.Params OR {}));\n    -- Update the incantation with the initial hash computed by DBSP\n    IF $res.result_hash != NONE THEN {\n        UPDATE _spooky_query SET Hash = $res.result_hash, Tree = $res.tree WHERE Id = $after.Id; \n    } END;\n};\n-- ==================================================\n-- FUNCTION: CALCULATE VIEW HASH\n-- Usage: fn::spooky::view_hash(thread:123, ['comments'])\n-- ==================================================\nDEFINE FUNCTION fn::spooky::view_hash($rid: record, $paths: array<string>) {\n    LET $shadow = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $rid);\n    IF $shadow.RecordId == NONE { RETURN crypto::blake3(\"\"); };\n\n    -- 1. Start with the Intrinsic Hash\n    LET $parts = [$shadow.IntrinsicHash];\n\n    -- 2. Collect requested Composition Hashes (if they exist)\n    -- We use a subquery to map the $paths array to values safely\n    LET $extras = (\n        SELECT VALUE $shadow.CompositionHash[$this] \n        FROM $paths \n        WHERE $shadow.CompositionHash[$this] != NONE\n    );\n\n    -- 3. Combine and Aggregate\n    LET $all_parts = array::concat($parts, $extras);\n    \n    RETURN mod::xor::blake3_xor_multi($all_parts);\n};\n\n-- ==================================================\n-- FUNCTION: REGISTER INCANTATION (With Sorting)\n-- Usage: fn::query::register({ ... sort_field: 'created_at' ... })\n-- ==================================================\nDEFINE FUNCTION fn::query::register($config: object) {\n    -- UNPACK CONFIG\n    LET $id         = $config.id;\n    LET $client_id   = $config.client_id;\n    LET $items      = $config.items;\n    LET $paths      = $config.paths;\n    LET $table      = $config.table;\n    LET $filter     = $config.filter;\n    LET $query      = $config.query; -- Optional DBSP Plan (SQL String)\n    \n    -- Sorting Params (Default to created_at if missing)\n    LET $sort_field = $config.sort_field OR 'created_at';\n    LET $tree_init = {}; \n    \n    -- 1. CALCULATE AGGREGATE HASH\n    LET $hashes = (\n        SELECT VALUE fn::spooky::view_hash(id, $paths) \n        FROM $items\n    );\n    LET $query_hash = mod::xor::blake3_xor_multi($hashes);\n\n    -- 2. UPDATE INCANTATION REGISTRY\n    -- Use String Cast for ID to avoid type::thing issues during schema load\n    LET $rid_str = \"_spooky_query:\" + $id;\n    LET $rid = <record>$rid_str;\n    \n    INSERT INTO _spooky_query {\n        id:           $rid,\n        Id:           $id,\n        Hash:         $query_hash,\n        ClientId:     $client_id,\n        sql:    $query,\n        Tree:         <object>{},\n        LastActiveAt: time::now(),\n        TTL:          1h\n    };\n\n\n\n    -- 5. REGISTER WITH DBSP (If plan provided)\n    IF $query != NONE THEN {\n        LET $state = fn::dbsp::get_state();\n        LET $dbsp_res = mod::dbsp::register_query($id, $query, $state);\n        fn::dbsp::save_state($dbsp_res.new_state);\n        \n        LET $init_res = $dbsp_res.result;\n        IF $init_res != NONE THEN {\n            -- Update using the explicit ID\n            UPDATE $rid SET Hash = $init_res.hash, Tree = $init_res.tree;\n        } END;\n        \n        -- DEBUG: Return the entire result to inspect state\n        RETURN $dbsp_res;\n    } END;\n\n    RETURN $query_hash;\n};\n\nDEFINE FUNCTION fn::query::heartbeat($id: record) {\n    UPDATE $id SET LastActiveAt = time::now();\n};\n-- ==================================================\n-- AUTO-GENERATED SPOOKY EVENTS\n-- ==================================================\n\n-- Meta Table: _spooky_data_hash Mutation\n-- Automatically recalculates TotalHash when IntrinsicHash or CompositionHash changes\nDEFINE EVENT OVERWRITE _spooky_data_hash_mutation ON TABLE _spooky_data_hash\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $new_total = mod::xor::blake3_xor($after.IntrinsicHash, $after.CompositionHash._xor);\n    IF $new_total != $after.TotalHash THEN {\n        UPDATE _spooky_data_hash SET TotalHash = $new_total WHERE RecordId = $after.RecordId;\n    } END;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE comment TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: comment Cascade Down (Reference Propagation)\n-- Table: comment Mutation\nDEFINE EVENT OVERWRITE _spooky_comment_mutation ON TABLE comment\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        author: <string>($after.author OR \"\"),\n        content: $after.content,\n        created_at: <string>($after.created_at OR \"\"),\n        thread: <string>($after.thread OR \"\"),\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('comment', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $ref_hash_author = IF $after.author != NONE THEN (SELECT TotalHash FROM ONLY _spooky_data_hash WHERE RecordId = $after.author).TotalHash ELSE crypto::blake3(\"\") END;\n    LET $ref_hash_author = IF $ref_hash_author != NONE THEN $ref_hash_author ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $ref_hash_author);\n    LET $h_content = crypto::blake3(<string>$after.content OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_content);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $record_id);\n    LET $new_composition = {\n        author: $ref_hash_author,\n        _xor: $xor_composition,\n    };\n\n    UPSERT _spooky_data_hash CONTENT {\n        RecordId: $after.id,\n        IntrinsicHash: $xor_intrinsic,\n        CompositionHash: $new_composition,\n        TotalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n    LET $new_total = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    LET $old_total = IF $old_hash_data.RecordId != NONE THEN $old_hash_data.TotalHash ELSE $new_total END;\n    LET $old_total_for_delta = IF $old_hash_data.RecordId != NONE THEN $old_hash_data.TotalHash ELSE crypto::blake3(\"\") END;\n    -- BUBBLE UP to Parent (thread)\n    LET $new_total_after = (SELECT TotalHash FROM ONLY _spooky_data_hash WHERE RecordId = $after.id).TotalHash;\n    LET $new_total_calculated = mod::xor::blake3_xor($xor_intrinsic, $xor_composition);\n    IF $before.thread = $after.thread THEN {\n        LET $delta = mod::xor::blake3_xor($old_total_for_delta, $new_total_calculated);\n        UPDATE _spooky_data_hash SET\n            CompositionHash.comment = mod::xor::blake3_xor((CompositionHash.comment OR $empty_hash), $delta),\n            CompositionHash._xor = mod::xor::blake3_xor(CompositionHash._xor, $delta)\n        WHERE RecordId = $after.thread;\n    } ELSE {\n        UPDATE _spooky_data_hash SET\n            CompositionHash.comment = mod::xor::blake3_xor((CompositionHash.comment OR $empty_hash), $old_total_for_delta),\n            CompositionHash._xor = mod::xor::blake3_xor(CompositionHash._xor, $old_total_for_delta)\n        WHERE RecordId = $before.thread AND RecordId != NONE;\n\n        UPDATE _spooky_data_hash SET\n            CompositionHash.comment = mod::xor::blake3_xor((CompositionHash.comment OR $empty_hash), $new_total_calculated),\n            CompositionHash._xor = mod::xor::blake3_xor(CompositionHash._xor, $new_total_calculated)\n        WHERE RecordId = $after.thread AND RecordId != NONE;\n    } END;\n\n};\n\n-- Table: comment Deletion\nDEFINE EVENT OVERWRITE _spooky_comment_delete ON TABLE comment\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        author: <string>($before.author OR \"\"),\n        content: $before.content,\n        created_at: <string>($before.created_at OR \"\"),\n        thread: <string>($before.thread OR \"\"),\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('comment', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $before.id);\n    LET $old_total = $old_hash_data.TotalHash;\n\n    -- BUBBLE UP Delete to Parent\n    IF $old_total != NONE AND $before.thread != NONE THEN {\n        UPDATE _spooky_data_hash SET\n            CompositionHash.comment = mod::xor::blake3_xor((CompositionHash.comment OR $empty_hash), $old_total),\n            CompositionHash._xor = mod::xor::blake3_xor(CompositionHash._xor, $old_total)\n        WHERE RecordId = $before.thread;\n    } END;\n\n    DELETE _spooky_data_hash WHERE RecordId = $before.id;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE thread TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: thread Cascade Down (Reference Propagation)\nDEFINE EVENT _spooky_z_cascade_comment_thread ON TABLE thread\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE comment SET _spooky_touch = time::now() WHERE thread = $after.id;\n};\n\n-- Table: thread Mutation\nDEFINE EVENT OVERWRITE _spooky_thread_mutation ON TABLE thread\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        author: <string>($after.author OR \"\"),\n        content: $after.content,\n        created_at: <string>($after.created_at OR \"\"),\n        title: $after.title,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('thread', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $ref_hash_author = IF $after.author != NONE THEN (SELECT TotalHash FROM ONLY _spooky_data_hash WHERE RecordId = $after.author).TotalHash ELSE crypto::blake3(\"\") END;\n    LET $ref_hash_author = IF $ref_hash_author != NONE THEN $ref_hash_author ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $ref_hash_author);\n    LET $h_content = crypto::blake3(<string>$after.content OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_content);\n    LET $h_title = crypto::blake3(<string>$after.title OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_title);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $record_id);\n    LET $h_comment = IF $old_hash_data.RecordId != NONE THEN $old_hash_data.CompositionHash.comment ELSE crypto::blake3(\"\") END;\n    LET $xor_composition = mod::xor::blake3_xor($xor_composition, $h_comment);\n    LET $new_composition = {\n        comment: $h_comment,\n        author: $ref_hash_author,\n        _xor: $xor_composition,\n    };\n\n    UPSERT _spooky_data_hash CONTENT {\n        RecordId: $after.id,\n        IntrinsicHash: $xor_intrinsic,\n        CompositionHash: $new_composition,\n        TotalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n};\n\n-- Table: thread Deletion\nDEFINE EVENT OVERWRITE _spooky_thread_delete ON TABLE thread\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        author: <string>($before.author OR \"\"),\n        content: $before.content,\n        created_at: <string>($before.created_at OR \"\"),\n        title: $before.title,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('thread', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $before.id);\n    LET $old_total = $old_hash_data.TotalHash;\n\n    DELETE _spooky_data_hash WHERE RecordId = $before.id;\n};\n\nDEFINE FIELD _spooky_touch ON TABLE user TYPE any PERMISSIONS FOR select, create, update WHERE false;\n\n-- Table: user Cascade Down (Reference Propagation)\nDEFINE EVENT _spooky_z_cascade_comment_author ON TABLE user\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE comment SET _spooky_touch = time::now() WHERE author = $after.id;\n};\n\nDEFINE EVENT _spooky_z_cascade_thread_author ON TABLE user\nWHEN $event != \"DELETE\"\nTHEN {\n    UPDATE thread SET _spooky_touch = time::now() WHERE author = $after.id;\n};\n\n-- Table: user Mutation\nDEFINE EVENT OVERWRITE _spooky_user_mutation ON TABLE user\nWHEN $before != $after AND $event != \"DELETE\"\nTHEN {\n    LET $plain_after = {\n        id: <string>($after.id OR \"\"),\n        created_at: <string>($after.created_at OR \"\"),\n        password: $after.password,\n        username: $after.username,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('user', $event, <string>($after.id OR \"\"), $plain_after);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $xor_intrinsic = crypto::blake3(\"\");\n    LET $xor_composition = crypto::blake3(\"\");\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $new_composition = {};\n    LET $h_username = crypto::blake3(<string>$after.username OR \"\");\n    LET $xor_intrinsic = mod::xor::blake3_xor($xor_intrinsic, $h_username);\n    LET $record_id = $before.id OR $after.id;\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $record_id);\n    LET $new_composition = {\n        _xor: $xor_composition,\n    };\n\n    UPSERT _spooky_data_hash CONTENT {\n        RecordId: $after.id,\n        IntrinsicHash: $xor_intrinsic,\n        CompositionHash: $new_composition,\n        TotalHash: NONE -- Placeholder, will be recalculated by event\n    };\n\n    -- ==================================================\n    -- CASCADE DOWN (Disabled for Object Hash for now)\n    -- Logic: {} Change -> Updates Dependent INTRINSIC Hash\n    -- ==================================================\n    -- (Skipped implementation for object hash)\n\n};\n\n-- Table: user Deletion\nDEFINE EVENT OVERWRITE _spooky_user_delete ON TABLE user\nWHEN $event = \"DELETE\"\nTHEN {\n    LET $empty_hash = crypto::blake3(\"\");\n    LET $plain_before = {\n        id: <string>($before.id OR \"\"),\n        created_at: <string>($before.created_at OR \"\"),\n        password: $before.password,\n        username: $before.username,\n    };\n    LET $dbsp_ok = mod::dbsp::ingest('user', \"DELETE\", <string>($before.id OR \"\"), $plain_before);\n    FOR $u IN $dbsp_ok.updates {\n        UPDATE _spooky_query SET Hash = $u.result_hash, Tree = $u.tree WHERE Id = $u.query_id;\n    };\n    LET $saved = mod::dbsp::save_state(NONE);\n\n    LET $old_hash_data = (SELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $before.id);\n    LET $old_total = $old_hash_data.TotalHash;\n\n    DELETE _spooky_data_hash WHERE RecordId = $before.id;\n};\n\n" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m21056[0m
[2m2025-12-28T18:30:49.163827Z[0m [34mDEBUG[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::iam::file[0m[2m:[0m Allowed bucket folder path: /modules [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.167049Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"21103" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"3138ca67-3888-44c2-b352-7e0ea1082fa9" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m4[0m
[2m2025-12-28T18:30:49.172760Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.172783Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.172795Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.172818Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:49.172848Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"RETURN mod::dbsp::reset({})" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m27[0m
[2m2025-12-28T18:30:49.172897Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::reset' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.423440Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"DELETE _spooky_module_state:dbsp" [3mlength[0m[2m=[0m32[0m [2m[3minput[0m[2m=[0m"DELETE _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m32[0m
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.423524Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mDELETE _spooky_module_state:dbsp
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:50.423812Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"73" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"1dfe416a-c69f-43a1-ab40-9a2a6814c223" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m1251[0m
[2m2025-12-28T18:30:50.428543Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.428565Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.428583Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.428630Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.428673Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"RETURN mod::dbsp::register_view(\"storage_view\", \"SELECT * FROM storage_items\", {})" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m82[0m
[2m2025-12-28T18:30:50.428723Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: register_view called with id: storage_view, params: Object {}
DEBUG: load_state: Loading from DB...
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.429246Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-28T18:30:50.429281Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: register_view parsed params success: Object {}
ðŸŸ¢ Async body completed for: __sr_sql
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.429362Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m220[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{},\"last_hash\":\"\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m220[0m
[2m2025-12-28T18:30:50.429399Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{}},"views":[{"plan":{"id":"storage_view","root":{"op":"scan","table":"storage_items"}},"cache":{},"last_hash":"","params":{}}]}'
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:50.429802Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"128" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"26da3155-db7e-4614-bc8e-3412cc99e147" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m1[0m
[2m2025-12-28T18:30:50.432800Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.432811Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.432820Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.432842Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.432868Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"RETURN mod::dbsp::ingest(\"storage_items\", \"CREATE\", \"storage_items:1\", { val: 42, hash: \"0000\" })" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m97[0m
[2m2025-12-28T18:30:50.432911Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.433360Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-28T18:30:50.433415Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
ðŸŸ¢ Async body completed for: __sr_sql
DEBUG: ingest: table=storage_items, views=1, db_tables=1
DEBUG: ingest: table storage_items size=0
DEBUG: ingest received direct record: Object {"hash": String("0000"), "val": Number(42)}
DEBUG: process: view=storage_view, delta_len=1, hash=217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20, last_hash=
DEBUG: ingest: generated 1 updates
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.433602Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m424[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m424[0m
[2m2025-12-28T18:30:50.433636Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"storage_items":{"name":"storage_items","zset":{"storage_items:1":1},"rows":{"storage_items:1":{"hash":"0000","val":42}}}}},"views":[{"plan":{"id":"storage_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}}]}'
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:50.433974Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"143" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"5363c75e-2b18-4f8e-9897-941783852b51" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m1[0m
[2m2025-12-28T18:30:50.437601Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.437619Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.437629Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.437662Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.437690Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"SELECT * FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m39[0m
[2m2025-12-28T18:30:50.437744Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT * FROM _spooky_module_state:dbsp [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
  console.log
    Storage Res: [
      [
        {
          "content": "{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}",
          "id": "_spooky_module_state:dbsp"
        }
      ]
    ]

      at Object.<anonymous> (surrealdb/dbsp_storage.test.ts:42:13)

[2m2025-12-28T18:30:50.437876Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"85" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b9745197-cde1-467e-800c-b12e59880639" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:50.441999Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442013Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442021Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442041Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442060Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n      UPSERT _spooky_query:auto_test_view CONTENT {\n        Id: 'auto_test_view',\n        sql: 'SELECT * FROM storage_items',\n        Params: {},\n        TTL: 10m,\n        LastActiveAt: time::now(),\n        ClientId: 'test-client'\n      };\n    " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m257[0m
[2m2025-12-28T18:30:50.442117Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_query:auto_test_view CONTENT { Id: 'auto_test_view', sql: 'SELECT * FROM storage_items', Params: {  }, TTL: 10m, LastActiveAt: time::now(), ClientId: 'test-client' } [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442141Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'time::now' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.442392Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: register_view called with id: auto_test_view, params: String("{  }")
[2m2025-12-28T18:30:50.442876Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
DEBUG: load_state: Loading from DB...
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.442908Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
ðŸŸ¢ Async body completed for: __sr_sql
DEBUG: fix_surql_json input: {  }
DEBUG: process: view=auto_test_view, delta_len=1, hash=217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20, last_hash=
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
DEBUG: fix_surql_json output: {  }
DEBUG: register_view parsed params success: Object {}
[2m2025-12-28T18:30:50.443745Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m623[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m623[0m
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:50.443777Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"storage_items":{"name":"storage_items","zset":{"storage_items:1":1},"rows":{"storage_items:1":{"hash":"0000","val":42}}}}},"views":[{"plan":{"id":"storage_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}},{"plan":{"id":"auto_test_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}}]}'
[2m2025-12-28T18:30:50.444093Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPDATE _spooky_query SET Hash = $res.result_hash, Tree = $res.tree WHERE Id = $after.Id [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.444257Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"305" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"825bbeb7-9782-403b-b6ad-09661f40fe16" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m2[0m
[2m2025-12-28T18:30:50.446218Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.446232Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.446242Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.446264Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.446293Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"SELECT * FROM _spooky_query:auto_test_view" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m48[0m
[2m2025-12-28T18:30:50.446323Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT * FROM _spooky_query:auto_test_view [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.446374Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"95" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"b8f5b006-f382-46a0-8846-bf9999d97201" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:50.447604Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.447622Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.447629Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.447647Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.447670Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-28T18:30:50.447699Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.447745Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"92" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"740a3b90-f64c-4a64-80ef-8c47e47e0dbe" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:50.449811Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449827Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449832Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449847Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449861Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"CREATE user:alice SET username = 'alice', password = 'password123';" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m67[0m
[2m2025-12-28T18:30:50.449902Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mCREATE user:alice SET username = 'alice', password = 'password123' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449976Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'time::now' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449984Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'time::now' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.449994Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'string::len' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.450015Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'string::len' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.450248Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::ingest' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: load_state: Loading from DB...
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:50.450643Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-28T18:30:50.450667Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
DEBUG: ingest received direct record: Object {"created_at": String("2025-12-28T18:30:50.449986130Z"), "id": String("user:alice"), "password": String("password123"), "username": String("alice")}
ðŸŸ¢ Async body completed for: __sr_sql
DEBUG: ingest: table=user, views=2, db_tables=2
DEBUG: ingest: table user size=0
DEBUG: ingest: generated 0 updates
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:50.450787Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:alice\":1},\"rows\":{\"user:alice\":{\"created_at\":\"2025-12-28T18:30:50.449986130Z\",\"id\":\"user:alice\",\"password\":\"password123\",\"username\":\"alice\"}}},\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mlength[0m[2m=[0m802[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"user\":{\"name\":\"user\",\"zset\":{\"user:alice\":1},\"rows\":{\"user:alice\":{\"created_at\":\"2025-12-28T18:30:50.449986130Z\",\"id\":\"user:alice\",\"password\":\"password123\",\"username\":\"alice\"}}},\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m802[0m
[2m2025-12-28T18:30:50.450820Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"user":{"name":"user","zset":{"user:alice":1},"rows":{"user:alice":{"created_at":"2025-12-28T18:30:50.449986130Z","id":"user:alice","password":"password123","username":"alice"}}},"storage_items":{"name":"storage_items","zset":{"storage_items:1":1},"rows":{"storage_items:1":{"hash":"0000","val":42}}}}},"views":[{"plan":{"id":"storage_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}},{"plan":{"id":"auto_test_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}}]}'
[2m2025-12-28T18:30:50.450982Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::save_state' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.451457Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'crypto::blake3' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.451478Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'crypto::blake3' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.451482Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'crypto::blake3' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.451494Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'crypto::blake3' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:50.451543Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::xor::blake3_xor' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.361380Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT * FROM ONLY _spooky_data_hash WHERE RecordId = $record_id [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.361428Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_data_hash CONTENT { RecordId: $after.id, IntrinsicHash: $xor_intrinsic, CompositionHash: $new_composition, TotalHash: NONE } [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.361599Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::xor::blake3_xor' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.362069Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPDATE _spooky_data_hash SET TotalHash = $new_total WHERE RecordId = $after.RecordId [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.362146Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::xor::blake3_xor' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.362705Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPDATE comment SET _spooky_touch = time::now() WHERE author = $after.id [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.362788Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPDATE thread SET _spooky_touch = time::now() WHERE author = $after.id [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.362871Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"114" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"957e4f99-5d33-457b-a665-e45fd3680492" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m913[0m
[2m2025-12-28T18:30:51.365685Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365701Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365718Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365751Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365794Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"\n      UPSERT _spooky_query:param_test_view CONTENT {\n        Id: 'param_test_view',\n        sql: 'SELECT * FROM user WHERE id = $id',\n        Params: { id: \"user:alice\" },\n        TTL: 10m,\n        LastActiveAt: time::now(),\n        ClientId: 'test-client-param'\n      };\n    " [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m289[0m
[2m2025-12-28T18:30:51.365851Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_query:param_test_view CONTENT { Id: 'param_test_view', sql: 'SELECT * FROM user WHERE id = $id', Params: { id: 'user:alice' }, TTL: 10m, LastActiveAt: time::now(), ClientId: 'test-client-param' } [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365868Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'time::now' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.365917Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb_core::ctx::context[0m[2m:[0m Capabilities allowed function execution, target: 'mod::dbsp::register_view' [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
DEBUG: register_view called with id: param_test_view, params: String("{ id: 'user:alice' }")
DEBUG: load_state: Loading from DB...
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
[2m2025-12-28T18:30:51.366399Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mlength[0m[2m=[0m45[0m [2m[3minput[0m[2m=[0m"SELECT content FROM _spooky_module_state:dbsp" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m45[0m
[2m2025-12-28T18:30:51.366437Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT content FROM _spooky_module_state:dbsp
ðŸŸ¢ Async body completed for: __sr_sql
DEBUG: fix_surql_json input: { id: 'user:alice' }
DEBUG: fix_surql_json output: { "id": '"user":alice' }
DEBUG: register_view parsed params error: expected value at line 1 column 9 input: { "id": '"user":alice' }
ðŸ”µ Host function called: __sr_sql
ðŸŸ¡ Executing async body for: __sr_sql
ðŸŸ¢ Async body completed for: __sr_sql
[2m2025-12-28T18:30:51.367517Z[0m [35mTRACE[0m [1mexpr[0m:[1mexpr_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql value [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:alice\":1},\"rows\":{\"user:alice\":{\"created_at\":\"2025-12-28T18:30:50.449986130Z\",\"id\":\"user:alice\",\"password\":\"password123\",\"username\":\"alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"param_test_view\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":{\"$param\":\"id\"}}}},\"cache\":{},\"last_hash\":\"\",\"params\":null}]}'; RETURN []; }" [3mlength[0m[2m=[0m999[0m [2m[3minput[0m[2m=[0m"{ LET $ign = UPSERT _spooky_module_state:dbsp SET content = '{\"db\":{\"tables\":{\"storage_items\":{\"name\":\"storage_items\",\"zset\":{\"storage_items:1\":1},\"rows\":{\"storage_items:1\":{\"hash\":\"0000\",\"val\":42}}},\"user\":{\"name\":\"user\",\"zset\":{\"user:alice\":1},\"rows\":{\"user:alice\":{\"created_at\":\"2025-12-28T18:30:50.449986130Z\",\"id\":\"user:alice\",\"password\":\"password123\",\"username\":\"alice\"}}}}},\"views\":[{\"plan\":{\"id\":\"storage_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"auto_test_view\",\"root\":{\"op\":\"scan\",\"table\":\"storage_items\"}},\"cache\":{\"storage_items:1\":1},\"last_hash\":\"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20\",\"params\":{}},{\"plan\":{\"id\":\"param_test_view\",\"root\":{\"op\":\"filter\",\"input\":{\"op\":\"scan\",\"table\":\"user\"},\"predicate\":{\"type\":\"eq\",\"field\":\"id\",\"value\":{\"$param\":\"id\"}}}},\"cache\":{},\"last_hash\":\"\",\"params\":null}]}'; RETURN []; }" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: None, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m999[0m
[2m2025-12-28T18:30:51.367551Z[0m [35mTRACE[0m [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPSERT _spooky_module_state:dbsp SET content = '{"db":{"tables":{"storage_items":{"name":"storage_items","zset":{"storage_items:1":1},"rows":{"storage_items:1":{"hash":"0000","val":42}}},"user":{"name":"user","zset":{"user:alice":1},"rows":{"user:alice":{"created_at":"2025-12-28T18:30:50.449986130Z","id":"user:alice","password":"password123","username":"alice"}}}}},"views":[{"plan":{"id":"storage_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}},{"plan":{"id":"auto_test_view","root":{"op":"scan","table":"storage_items"}},"cache":{"storage_items:1":1},"last_hash":"217aad9648ea1731bd8896e8ca85547da215b636247fcc7be2bda20c47f01b20","params":{}},{"plan":{"id":"param_test_view","root":{"op":"filter","input":{"op":"scan","table":"user"},"predicate":{"type":"eq","field":"id","value":{"$param":"id"}}}},"cache":{},"last_hash":"","params":null}]}'
[2m2025-12-28T18:30:51.367871Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mUPDATE _spooky_query SET Hash = $res.result_hash, Tree = $res.tree WHERE Id = $after.Id [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.368015Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"337" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"ce16d252-e5da-40ed-9dfe-991df89fae4e" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m2[0m
[2m2025-12-28T18:30:51.369632Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.369645Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.369652Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.369673Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.369703Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"SELECT * FROM _spooky_query:param_test_view" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m49[0m
[2m2025-12-28T18:30:51.369733Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mprocess[0m:[1mexecutor[0m:[1mexecutor[0m:[1mexecutor[0m: [2msurrealdb::core::dbs[0m[2m:[0m Iterating statement [3mstatement[0m[2m=[0mSELECT * FROM _spooky_query:param_test_view [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.369785Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Finished processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"96" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"71392727-1223-4d09-aa9c-727704bc17d3" [3mclient.address[0m[2m=[0m"192.168.65.1" [3mhttp.response.status_code[0m[2m=[0m200 [3mhttp.latency.ms[0m[2m=[0m0[0m
[2m2025-12-28T18:30:51.379036Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_server::ntw::tracer[0m[2m:[0m Started processing request [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"245820fb-ff68-4531-b7a3-5f3dc7f04982" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.379055Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Attempting token authentication [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"245820fb-ff68-4531-b7a3-5f3dc7f04982" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.379059Z[0m [35mTRACE[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticating to root level with user `root` [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"245820fb-ff68-4531-b7a3-5f3dc7f04982" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.379076Z[0m [34mDEBUG[0m [1mrequest[0m: [2msurrealdb_core::iam::verify[0m[2m:[0m Authenticated to root level with user `root` using token [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"245820fb-ff68-4531-b7a3-5f3dc7f04982" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m
[2m2025-12-28T18:30:51.379095Z[0m [35mTRACE[0m [1mrequest[0m:[1mexecute[0m:[1mparse_with_capabilities[0m: [2msurrealdb::core::syn[0m[2m:[0m Parsing sql query [2m[3motel.kind[0m[2m=[0m"server" [3mhttp.request.method[0m[2m=[0m"POST" [3murl.path[0m[2m=[0m"/rpc" [3mnetwork.protocol.name[0m[2m=[0m"http" [3mnetwork.protocol.version[0m[2m=[0m"1.1" [3mhttp.request.body.size[0m[2m=[0m"71" [3muser_agent.original[0m[2m=[0m"node" [3motel.name[0m[2m=[0m"POST /rpc" [3mhttp.route[0m[2m=[0m"/rpc" [3mhttp.request.id[0m[2m=[0m"245820fb-ff68-4531-b7a3-5f3dc7f04982" [3mclient.address[0m[2m=[0m"192.168.65.1"[0m [2m[3minput[0m[2m=[0m"REMOVE DATABASE test_db;" [3mcapabilities[0m[2m=[0mCapabilities { scripting: true, guest_access: true, live_query_notifications: true, allow_funcs: All, deny_funcs: None, allow_net: All, deny_net: None, allow_rpc: All, deny_rpc: None, allow_http: All, deny_http: None, allow_experimental: All, deny_experimental: None, allow_arbitrary_query: All, deny_arbitrary_query: None } [3mlength[0m[2m=[0m24[0m
FAIL surrealdb/dbsp_storage.test.ts
  DBSP Storage Persistence
    âœ• should save state correctly to _spooky_module_state after ingest (2201 ms)

  â— DBSP Storage Persistence â€º should save state correctly to _spooky_module_state after ingest

    expect(received).not.toBe(expected) // Object.is equality

    Expected: not ""

      114 |
      115 |     expect(paramRecord.Hash).toBeDefined();
    > 116 |     expect(paramRecord.Hash).not.toBe('');
          |                                  ^
      117 |     expect(paramRecord.Hash).not.toBe('NONE');
      118 |
      119 |     const state = JSON.parse(records[0].content);

      at Object.<anonymous> (surrealdb/dbsp_storage.test.ts:116:34)

Test Suites: 1 failed, 1 total
Tests:       1 failed, 1 total
Snapshots:   0 total
Time:        3.529 s, estimated 4 s
Ran all test suites matching /surrealdb\/dbsp_storage.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
